<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ã¯ã¬ã¬ã‚“ã‚¯ã‚¨ã‚¹ãƒˆ ï½PTAãªå‹‡è€…ãŸã¡ï½ Ver.0.3</title>
<style>
    :root {
        --bg-color: #212529;
        --panel-bg: #343a40;
        --text-color: #f8f9fa;
        --accent-color: #e74c3c;
        --highlight-color: #f1c40f;
        --btn-bg: #495057;
        --border-color: #6c757d;
        --log-bg: rgba(0,0,0,0.6);
    }
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        min-height: 100vh;
        touch-action: manipulation; 
    }
    #game-container {
        width: 100%;
        max-width: 600px;
        background-color: var(--panel-bg);
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
        min-height: 100vh;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    
    h1, h2, h3 { text-align: center; margin: 10px 0; color: var(--highlight-color); text-shadow: 1px 1px 2px #000; }
    button {
        background-color: var(--btn-bg);
        color: #fff;
        border: 1px solid #adb5bd;
        padding: 12px;
        margin: 4px;
        cursor: pointer;
        border-radius: 8px;
        font-weight: bold;
        font-size: 1rem;
        transition: background 0.1s;
        min-height: 48px;
    }
    button:active:not(:disabled) { background-color: #ced4da; color: #000; transform: translateY(2px); }
    button:disabled { 
        opacity: 0.4; 
        cursor: not-allowed; 
        transform: none;
        background-color: #6c757d;
    }
    
    .screen { display: none; padding: 15px; animation: fadeIn 0.3s; padding-bottom: 80px; }
    .active { display: block !important; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .char-grid { 
        display: grid; 
        grid-template-columns: repeat(2, 1fr);
        gap: 8px; 
    }
    .char-card { 
        border: 2px solid var(--border-color); 
        background: rgba(255,255,255,0.05);
        padding: 8px; 
        cursor: pointer; 
        border-radius: 8px;
        font-size: 0.9rem;
        transition: all 0.2s;
    }
    .char-card:active {
        transform: scale(0.98);
    }
    .char-card.selected { 
        border-color: var(--highlight-color); 
        background-color: rgba(241, 196, 15, 0.2); 
        box-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
    }
    
    .status-card {
        background: rgba(0,0,0,0.3);
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 8px;
        font-size: 0.9rem;
    }
    .stat-btn-group { display: flex; gap: 5px; margin-top: 5px; }
    .stat-btn-group button { flex: 1; padding: 5px; font-size: 0.8rem; min-height: 35px; }

    #battle-area {
        display: flex;
        flex-direction: column;
        height: 100vh;
        padding: 0;
    }
    #battle-header {
        padding: 10px;
        background: rgba(0,0,0,0.2);
    }
    #battle-visual {
        text-align: center;
        margin: 10px 0;
    }
    #battle-log {
        flex: 1;
        overflow-y: auto;
        background: var(--log-bg);
        border-top: 2px solid var(--border-color);
        padding: 10px;
        font-size: 0.95rem;
        font-family: sans-serif;
        line-height: 1.4;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        scroll-behavior: smooth;
    }
    .log-entry { 
        margin-bottom: 6px; 
        border-bottom: 1px dashed rgba(255,255,255,0.1); 
        padding-bottom: 2px; 
    }
    .log-quote { 
        color: #aaa; 
        font-style: italic; 
        font-size: 0.85em; 
        display: block; 
        margin-top: 2px; 
    }
    
    #command-panel {
        background: #222;
        padding: 10px;
        border-top: 2px solid var(--highlight-color);
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 5px;
        padding-bottom: 20px;
    }
    #command-panel button { margin: 0; width: 100%; }
    .btn-skill-2 { 
        background-color: #d35400; 
        border-color: #e67e22; 
        color: #fff; 
        box-shadow: 0 0 5px #e67e22; 
    }

    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); z-index: 100;
        display: none; align-items: center; justify-content: center;
        padding: 20px; box-sizing: border-box;
    }
    .modal-content {
        background: var(--panel-bg); border: 2px solid var(--highlight-color);
        padding: 20px; width: 100%; max-width: 500px;
        border-radius: 10px; text-align: center;
        max-height: 90vh; overflow-y: auto;
    }
    
    .bar-container { width: 100%; background: #555; height: 10px; border-radius: 5px; margin: 3px 0; overflow: hidden; }
    .hp-bar { height: 100%; background: #e74c3c; width: 100%; transition: width 0.3s; }
    .mp-bar { height: 100%; background: #3498db; width: 100%; transition: width 0.3s; }

    .c-yellow { color: var(--highlight-color); }
    .c-red { color: #e74c3c; }
    .c-green { color: #2ecc71; }
    .c-blue { color: #3498db; }
</style>
</head>
<body>

<div id="game-container">
    <div id="screen-title" class="screen active" style="text-align:center;">
        <h1 style="font-size:2.2rem; margin-top:50px;">ã¯ã¬ã¬ã‚“<br>ã‚¯ã‚¨ã‚¹ãƒˆv0.3</h1>
        <h3 style="color:#fff;">Ver 0.3</h3>
        <p>PTAãªå‹‡è€…ãŸã¡ã¨æŒ‘ã‚€<br>åœ°åŸŸå¯†ç€å‹RPG</p>
        <button onclick="Game.toHeroSelect()" style="width:80%; margin-top:30px; font-size:1.2rem;">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button onclick="Game.toggleHelp()" style="width:80%; margin-top:10px;">ãƒ˜ãƒ«ãƒ— / æ”»ç•¥æƒ…å ±</button>
    </div>

    <div id="screen-select-hero" class="screen">
        <h2>ä¸»äººå…¬ã‚’é¸æŠ</h2>
        <div id="hero-select-grid" class="char-grid"></div>
        <div style="position:sticky; bottom:0; background:var(--panel-bg); padding:10px; text-align:center; border-top:1px solid #555;">
            <button id="hero-confirm-btn" onclick="Game.confirmHero()" disabled style="width:100%;">ã“ã®ã‚­ãƒ£ãƒ©ã§æ±ºå®š</button>
        </div>
    </div>

    <div id="screen-select-party" class="screen">
        <h2>ä»²é–“ã‚’2åé¸æŠ <span id="party-count-text" style="font-size:0.8em;">(ã‚ã¨2å)</span></h2>
        <div id="party-select-grid" class="char-grid"></div>
        <div style="position:sticky; bottom:0; background:var(--panel-bg); padding:10px; text-align:center; border-top:1px solid #555;">
            <button id="party-confirm-btn" onclick="Game.confirmParty()" disabled style="width:100%;">çµæˆå®Œäº†ï¼</button>
        </div>
    </div>

    <div id="screen-hub" class="screen">
        <h3>ä¼šè­°å®¤ (ç¬¬<span id="floor-indicator">1</span>éšå±¤)</h3>
        
        <div id="hub-status-list"></div>

        <div style="margin-top:20px; border-top:1px dashed #777; padding-top:10px;">
            <h4>ãƒã‚¶ãƒ¼ (æ‰€æŒé‡‘: <span id="gold-display">0</span>G)</h4>
            <div id="shop-list"></div>
        </div>

        <div style="text-align:center; margin-top:30px;">
            <button onclick="Game.showEncounter()" style="width:100%; background:#d35400; font-size:1.2rem;">>> å‡ºé™£ã™ã‚‹ <<</button>
        </div>
    </div>

    <div id="screen-battle" class="screen" style="padding:0; display:none;">
        <div id="battle-area">
            <div id="battle-header">
                <div id="turn-indicator" style="font-size:0.8em; color:#ccc; text-align:center;">Turn 1</div>
                <div class="enemy-display">
                    <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                        <span id="enemy-name" style="font-size:1.2em; font-weight:bold; color:#e74c3c;">æ•µ</span>
                        <span id="enemy-hp-text" style="font-size:0.8em;">HP: ???</span>
                    </div>
                    <div class="bar-container"><div id="enemy-hp" class="hp-bar"></div></div>
                </div>
                <div id="battle-party-status" style="display:flex; gap:5px; margin-top:10px; overflow-x:auto;"></div>
            </div>

            <div id="battle-log"></div>

            <div id="command-panel" style="display:none;">
                <div style="grid-column: 1 / -1; text-align:center; margin-bottom:5px; color:#fff;">
                    <span id="active-char-name" style="font-weight:bold;"></span> ã®è¡Œå‹•
                </div>
                <button onclick="Battle.action('attack')">æ”»æ’ƒ</button>
                <button onclick="Battle.action('guard')">é˜²å¾¡/é›†ä¸­</button>
                <button onclick="Battle.action('skill1')" id="btn-skill1" class="c-yellow">ç‰¹æŠ€</button>
                <button onclick="Battle.action('skill2')" id="btn-skill2" class="btn-skill-2" style="display:none;">â˜…å¿…æ®º</button>
            </div>
        </div>
    </div>

    <div id="modal-encounter" class="modal-overlay">
        <div class="modal-content">
            <h2 class="c-red">ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼å‡ºç¾ï¼</h2>
            <div id="encounter-msg" style="font-style:italic; margin:20px 0; font-size:1.1em;"></div>
            <p id="encounter-enemy-name" style="font-weight:bold;"></p>
            <button onclick="Battle.startCombat()" style="width:80%; background:#e74c3c;">æˆ¦é—˜é–‹å§‹ï¼</button>
        </div>
    </div>

    <div id="modal-help" class="modal-overlay" onclick="Game.toggleHelp()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3>ğŸ”° PTAå‹‡è€…ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</h3>
            <ul style="text-align:left; padding-left:20px; font-size:0.9em; line-height:1.8;">
                <li><b>ç›®çš„:</b> å…¨10éšå±¤ã«å­˜åœ¨ã™ã‚‹åœ°åŸŸã®ã€Œå›°ã£ãŸäººãŸã¡ã€ã‚’èª¬å¾—ã—ã€é­”ç‹ã¯ã¬ã¬ã‚’å€’ã™ã“ã¨ã€‚</li>
                <li><b>æˆé•·:</b> æ•µã‚’å€’ã™ã¨Ptç²å¾—ã€‚ã€Œä¼šè­°å®¤ã€ã§èƒ½åŠ›ã«æŒ¯ã‚Šåˆ†ã‘ã¦ãã ã•ã„ã€‚
                    <br>ãƒ»<b>ç­‹åŠ›:</b> æ”»æ’ƒãƒ»é˜²å¾¡UP (ç‰©ç†å‘ã‘) HP+15
                    <br>ãƒ»<b>çŸ¥åŠ›:</b> MPãƒ»é­”æ³•åŠ›UP (é­”æ³•å‘ã‘) MP+10
                    <br>ãƒ»<b>æ•æ·:</b> è¡Œå‹•é †ãƒ»å›é¿UP (å…¨å“¡é‡è¦)
                </li>
                <li><b>â˜…éš ã—ã‚¹ã‚­ãƒ«:</b> å„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ<span class="c-yellow">15</span>ã‚’è¶…ãˆã‚‹ã¨ã€å¼·åŠ›ãªç¬¬2ã‚¹ã‚­ãƒ«ãŒè§£ç¦ã•ã‚Œã¾ã™ï¼</li>
                <li><b>ãƒãƒƒã‚¯ç”·ã®ä»•æ§˜:</b> MPã§ã¯ãªãã€Œæ‰€æŒé‡‘ã€ã‚’æ¶ˆè²»ã—ã¦æˆ¦ã„ã¾ã™ã€‚</li>
                <li><b>é˜²å¾¡/é›†ä¸­:</b> é˜²å¾¡ã™ã‚‹ã¨ãƒ€ãƒ¡ãƒ¼ã‚¸è»½æ¸›ã«åŠ ãˆã€MPãŒå°‘ã—å›å¾©ã—ã¾ã™ã€‚</li>
                <li><b>æ³¨æ„:</b> ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¡ãƒ³ãƒãƒ¼ãŒå…¨å“¡å€’ã‚Œã‚‹ã¨æ•—åŒ—ã§ã™ã€‚</li>
            </ul>
            <button onclick="Game.toggleHelp()" style="margin-top:15px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    
    <div id="modal-ending" class="modal-overlay">
        <div class="modal-content">
            <h1>MISSION COMPLETE!</h1>
            <div id="ending-text" style="white-space: pre-wrap; line-height: 1.6; text-align:left; font-size:0.9em; max-height:70vh; overflow-y:auto;"></div>
            <button onclick="location.reload()" style="margin-top:20px; width:100%;">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
        </div>
    </div>
</div>

<script>
/* --- 1. ãƒ‡ãƒ¼ã‚¿å®šç¾© (ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ & æ•µ) --- */
const UNLOCK_THRESHOLD = 15;

const ROLES = {
    nayuta: { 
        name: "å‹‡è€…ï¼šãªã‚†ãŸ", stats: { str:8, int:5, agi:6 }, 
        skill1: { name:"å‹‡æ°—ã®å·ä»¤", cost:15, desc:"å‘³æ–¹å…¨å“¡ã®æ”»æ’ƒUP" },
        skill2: { name:"ã‚®ã‚¬ãƒ™ãƒ¼ãƒ«", cost:40, desc:"[å¿…æ®º] å‘³æ–¹å…¨å“¡ç„¡æ•µ(1T)", type:"support" },
        desc: "ãŠãªã˜ã¿æˆ‘ã‚‰ãŒå‹‡è€…ã€‚ãŠé¢¨å‘‚ã¨æ•°å­—ã¯è‹¦æ‰‹ã€‚",
        quotes: { atk:["ä»»ã›ã¦ï¼","å¤§ä¸ˆå¤«ã§ã™ï¼"], skill:["ç§ã€æ­Œã„ã¾ã™ï¼","ã¿ã‚“ãªã®ãƒã‚«ãƒ©ã‚’ä¸€ã¤ã«ï¼"], guard:["æ§˜å­ã‚’è¦‹ã¾ã™ã€‚"], win:["ä¼šè­°ã¯è¸Šã‚‹ã€ã•ã‚Œã©é€²ã¾ãšâ€¦"] }
    },
    kakapo: { 
        name: "å†·å¾¹ä¼šè¨ˆï¼šã‚«ã‚«ãƒ", stats: { str:3, int:10, agi:5 },
        skill1: { name:"äºˆç®—å‡çµ", cost:15, desc:"æ•µå˜ä½“ã«æ°·å±æ€§å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸" },
        skill2: { name:"å¼·åˆ¶ç›£æŸ»", cost:30, desc:"[å¿…æ®º] æ•µã®ç¾HPã‚’20%å‰Šã‚‹", type:"magic" },
        desc: "ç„¡é§„ãªå‡ºè²»ã¯1å††ã‚‚è¨±ã•ãªã„ã€‚",
        quotes: { atk:["è¨ˆç®—é€šã‚Šã€‚","ç„¡é§„ã§ã™ã­ã€‚"], skill:["å‡çµå‡¦åˆ†ã¨ã—ã¾ã™ã€‚","ç›£æŸ»ã«å…¥ã‚Šã¾ã™ï¼"], guard:["ãƒªã‚¹ã‚¯ãƒ˜ãƒƒã‚¸ã€‚"], win:["æ±ºç®—å ±å‘Šã€ç•°å¸¸ãªã—ã€‚"] }
    },
    fum: { 
        name: "æ…ˆæ„›ã®åƒ§ä¾¶ï¼šfum", stats: { str:4, int:8, agi:5 },
        skill1: { name:"ç™’ã‚„ã—ã®æ ¹å›ã—", cost:15, desc:"å‘³æ–¹å…¨å“¡ã®HPå°å›å¾©" },
        skill2: { name:"è–ãªã‚‹å˜†é¡˜æ›¸", cost:40, desc:"[å¿…æ®º] å‘³æ–¹å…¨å“¡ã®HPå®Œå…¨å›å¾©", type:"heal" },
        desc: "äº‹å‰ã®æ ¹å›ã—ã§ãƒˆãƒ©ãƒ–ãƒ«ã‚’é˜²ãã€‚",
        quotes: { atk:["ãŠã‚„ã‚ãã ã•ã„ï¼","ç—›ã„ã®ã¯ãƒ€ãƒ¡ã§ã™ã€‚"], skill:["çš†ã•ã‚“ãŒç„¡äº‹ã§ã‚ã‚Šã¾ã™ã‚ˆã†ã«â€¦","æ ¹å›ã—ã—ã¦ãŠãã¾ã—ãŸã€‚"], guard:["è€ãˆã¾ã™â€¦ï¼"], win:["å¹³å’Œçš„è§£æ±ºã§ã™ã­ã€‚"] }
    },
    yj: { 
        name: "ç­‹è‚‰æˆ¦å£«ï¼šYJ", stats: { str:10, int:2, agi:4 },
        skill1: { name:"è‚‰ä½“è¨€èª", cost:10, desc:"è‡ªåˆ†ç„¡æ•µ(1T)+æ³¨ç›®é›†ã‚" },
        skill2: { name:"ãƒãƒƒã‚¹ãƒ«ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ", cost:25, desc:"[å¿…æ®º] ç­‹åŠ›ä¾å­˜ã®è¶…æ¥µå¤§ãƒ€ãƒ¡ãƒ¼ã‚¸", type:"phys" },
        desc: "è­°è«–ã‚ˆã‚Šç­‹è‚‰ã§è§£æ±ºã™ã‚‹ã€‚",
        quotes: { atk:["ãƒ•ãƒ³ãƒƒï¼","ãƒ’ãƒ§ãƒ­ã‚¬ãƒªãŒï¼"], skill:["ä¿ºã®è‚©å¹…ã‚’è¦‹ã‚ï¼","ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ï¼ï¼"], guard:["ã‚«ãƒƒãƒã‚«ãƒã ãï¼"], win:["ãƒ‘ãƒ³ãƒ—ã‚¢ãƒƒãƒ—å®Œäº†ï¼"] }
    },
    usan: { 
        name: "ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ï¼šã†ãƒ¼ã•ã‚“", stats: { str:5, int:9, agi:6 },
        skill1: { name:"è«–ç†çš„ãƒãƒƒã‚¯", cost:12, desc:"æ•µã®æ”»æ’ƒï¼†é˜²å¾¡ãƒ€ã‚¦ãƒ³" },
        skill2: { name:"ã‚·ã‚¹ãƒ†ãƒ ãƒ€ã‚¦ãƒ³", cost:30, desc:"[å¿…æ®º] æ•µã‚’ã‚¹ã‚¿ãƒ³(è¡Œå‹•ä¸èƒ½)ã•ã›ã‚‹", type:"magic" },
        desc: "ç†è©°ã‚ã§ç›¸æ‰‹ã‚’è¿½ã„è¾¼ã‚€ã€‚",
        quotes: { atk:["ãƒã‚°ç™ºè¦‹ã€‚","ãƒ‡ãƒãƒƒã‚°ã—ã¾ã™ã€‚"], skill:["è«–ç†ç ´ç¶»ã—ã¦ã¾ã™ã‚ˆã€‚","è„†å¼±æ€§ã‚’çªãã¾ã™ã€‚"], guard:["ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«å±•é–‹ã€‚"], win:["æ­£å¸¸çµ‚äº†ã—ã¾ã—ãŸã€‚"] }
    },
    akki: { 
        name: "ãƒãƒƒã‚¯ç”·ï¼šã‚ã£ããƒ¼", stats: { str:6, int:6, agi:7 },
        skill1: { name:"ãƒãƒ†ãƒˆä¹±ã‚ŒæŠ•ã’", cost:0, desc:"[é‡‘50G] ãƒ©ãƒ³ãƒ€ãƒ 3å›æ”»æ’ƒ" },
        skill2: { name:"ã‚¹ãƒã‚¤ãƒ«0å††", cost:0, desc:"[å¿…æ®º] å‘³æ–¹å…¨å“¡ã®MPå›å¾©+æ”»æ’ƒUP", type:"special" },
        desc: "å…¨ã¦ã¯ãƒã‚¯ãƒ‰ãƒŠãƒ«ãƒ‰ã®ãŸã‚ã«ã€‚",
        quotes: { atk:["ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ï¼","ã”ä¸€ç·’ã«ã„ã‹ãŒï¼Ÿ"], skill:["æšã’ãŸã¦ã§ã™ã‚ˆï¼","ã‚¹ãƒã‚¤ãƒ«å…¥ã‚Šã¾ã™ï¼"], guard:["ãƒ‰ãƒ©ã‚¤ãƒ–ã‚¹ãƒ«ãƒ¼ã§ã€‚"], win:["i'm lovin' it."] }
    },
    akachan: { 
        name: "å¥³å„ªï¼šã‚ã‹ã¡ã‚ƒã‚“", stats: { str:4, int:7, agi:8 },
        skill1: { name:"å˜˜æ³£ã", cost:15, desc:"æ•µã‚’é­…äº†ã—è¡Œå‹•ä¸èƒ½ã«ã™ã‚‹" },
        skill2: { name:"ä¸»æ¼”å¥³å„ªè³", cost:35, desc:"[å¿…æ®º] æ•µå…¨ä½“ã«ç²¾ç¥çš„ç‰¹å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸", type:"magic" },
        desc: "æ¼”æŠ€åŠ›ã§ä¸–æ¸¡ã‚Šã™ã‚‹ç­–å£«ã€‚",
        quotes: { atk:["ã‚„ã ãï½â™¡","ã”ã‚ã‚“ãªã•ãã„"], skill:["ç§ã€ã‹ã‚ã„ãã†ã§ã—ã‚‡ï¼Ÿ","è¦‹ã¦ï¼ç§ã®æ¼”æŠ€ã‚’ï¼"], guard:["ãƒ¡ã‚¤ã‚¯ç›´ã•ãªãã‚ƒã€‚"], win:["ãŠç–²ã‚Œæ§˜ã§ã—ãŸï½(ç´ )"] }
    },
    shira: { 
        name: "è‡ªç”±äººï¼šã—ã‚‰ã•ã‹", stats: { str:6, int:6, agi:9 },
        skill1: { name:"ã¡ã‚ƒã¶å°è¿”ã—", cost:20, desc:"ãƒ©ãƒ³ãƒ€ãƒ åŠ¹æœ(å›å¾©/æ”»æ’ƒ/è‡ªçˆ†)" },
        skill2: { name:"ãƒ‰ã‚¿ã‚­ãƒ£ãƒ³", cost:20, desc:"[å¿…æ®º] æ•µã®ã‚¿ãƒ¼ãƒ³ã‚’å¼·åˆ¶ã‚¹ã‚­ãƒƒãƒ—", type:"special" },
        desc: "ä¼šè­°ã‚’ç™½ç´™ã«æˆ»ã™ãƒˆãƒªãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ã€‚",
        quotes: { atk:["é£½ããŸãªï½","ãã‚Œã£"], skill:["ã¯ã„ã€ã‚„ã‚Šç›´ã—ï¼","ä»Šæ—¥ã¯å¸°ã‚Šã¾ãƒ¼ã™ã€‚"], guard:["èã„ã¦ã¾ã›ãƒ¼ã‚“ã€‚"], win:["è‡ªç”±ã ãƒ¼ï¼ï¼"] }
    },
    nyanya: { 
        name: "å‰µé€ è€…ï¼šã«ã‚ƒãƒ¼ã«ã‚ƒ", stats: { str:5, int:8, agi:6 },
        skill1: { name:"ã‚¤ãƒ™ãƒ³ãƒˆä¼ç”»", cost:20, desc:"å‘³æ–¹å…¨å“¡ã«ãƒãƒªã‚¢(HP+)" },
        skill2: { name:"å¤©åœ°å‰µé€ ", cost:50, desc:"[å¿…æ®º] å‘³æ–¹å…¨å“¡å…¨èƒ½åŠ›UP", type:"support" },
        desc: "æ¥½ã—ã„ä¼ç”»ã§å£«æ°—ã‚’ä¸Šã’ã‚‹ã€‚",
        quotes: { atk:["ã“ã‚Œã©ã†ï¼Ÿ","ã‚¨ã‚¤ãƒƒï¼"], skill:["æ–°ã—ã„ä¼ç”»æ€ã„ã¤ã„ãŸï¼","çš†ãŒæ¥½ã—ã‚ã‚‹ä¸–ç•Œã‚’ï¼"], guard:["æº–å‚™æœŸé–“ã§ã™ã€‚"], win:["å¤§æˆåŠŸã ã­ï¼"] }
    },
    kokona: { 
        name: "é£Ÿã„ã—ã‚“åŠï¼šã“ã“ãª", stats: { str:7, int:4, agi:6 },
        skill1: { name:"ã¤ã¾ã¿é£Ÿã„", cost:10, desc:"æ”»æ’ƒã—ã¦è‡ªåˆ†ã®HPå›å¾©" },
        skill2: { name:"å®´ä¼šéƒ¨é•·", cost:30, desc:"[å¿…æ®º] æ•µå…¨ä½“ã‚’é£²ã¿è¾¼ã‚€(å³æ­»orå¤§ãƒ€ãƒ¡)", type:"phys" },
        desc: "å·®ã—å…¥ã‚Œã¯å…¨ã¦å½¼å¥³ã®èƒƒè¢‹ã¸ã€‚",
        quotes: { atk:["ã„ãŸã ãã¾ã™ï¼","ãŠã‹ã‚ã‚Šï¼"], skill:["ãã‚Œç¾å‘³ã—ãã†ï¼","ã‚‚ãã‚‚ãâ€¦"], guard:["é£Ÿä¼‘ã¿ä¸­ã€‚"], win:["ã”ã¡ãã†ã•ã¾ã§ã—ãŸï¼"] }
    },
    terror: { name:"AIï¼šãƒ†ãƒ­ãƒ«", stats:{str:5,int:9,agi:7}, skill1:{name:"ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³",cost:15,desc:"æ•µã®å‘½ä¸­ç‡ãƒ€ã‚¦ãƒ³"}, skill2:{name:"ã‚·ãƒ³ã‚®ãƒ¥ãƒ©ãƒªãƒ†ã‚£",cost:40,desc:"æ•µå…¨ä½“ã«çŸ¥åŠ›ç‰¹å¤§ãƒ€ãƒ¡"}, desc:"äºˆæ¸¬ä¸èƒ½ãªAIã€‚", quotes:{atk:["æ¼”ç®—ä¸­...","å‰Šé™¤ã—ã¾ã™"],skill:["å­¦ç¿’ã—ã¾ã—ãŸ","ç¥ã‚’ç”Ÿæˆã—ã¾ã™"],guard:["ãƒ—ãƒ­ãƒ†ã‚¯ãƒˆ"],win:["æœ€é©è§£ã§ã—ãŸ"]} },
    orange: { name:"ä¸‡åšåšå£«ï¼šOrange", stats:{str:4,int:10,agi:4}, skill1:{name:"ãƒ‘ãƒ“ãƒªã‚ªãƒ³å»ºè¨­",cost:20,desc:"å‘³æ–¹é˜²å¾¡UP"}, skill2:{name:"æœªæ¥ã®è¼ã",cost:35,desc:"æ•µå…¨ä½“ã«å…‰ãƒ€ãƒ¡ãƒ¼ã‚¸"}, desc:"æœªæ¥ã‚’è¦‹æ®ãˆã‚‹åšå£«ã€‚", quotes:{atk:["å®Ÿé¨“é–‹å§‹","ãƒ‡ãƒ¼ã‚¿åé›†"],skill:["ã“ã‚ŒãŒæœªæ¥ã ï¼","ä¸‡åšã¸ã‚ˆã†ã“ã"],guard:["åˆ†æä¸­"],win:["ç§‘å­¦ã®å‹åˆ©ã "]} },
    jyun: { name:"ãƒãƒ³ã‚¿ãƒ¼ï¼šã¢ã‚…ã‚“æ±°", stats:{str:9,int:3,agi:8}, skill1:{name:"ã‚·ã‚«æ’ƒã¡",cost:15,desc:"å¿…ä¸­ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«æ”»æ’ƒ"}, skill2:{name:"ã‚¤ãƒã‚·ã‚·ç‹©ã‚Š",cost:30,desc:"ãƒ©ãƒ³ãƒ€ãƒ 4å›æ”»æ’ƒ"}, desc:"ç²ç‰©ã¯é€ƒã•ãªã„ã€‚", quotes:{atk:["é€ƒã•ã‚“ï¼","ãƒãƒ³ï¼"],skill:["æ€¥æ‰€ã ï¼","ãƒãƒã®å·£ã«ã—ã¦ã‚„ã‚‹"],guard:["éš ã‚Œã‚‹"],win:["ç‹©ã‚Šçµ‚äº†"]} },
    neo: { name:"ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ï¼šãƒã‚ª", stats:{str:8,int:8,agi:6}, skill1:{name:"ä¼èª¬ã®å¨åœ§",cost:15,desc:"æ•µæ”»æ’ƒãƒ€ã‚¦ãƒ³"}, skill2:{name:"å¤ã®å¿…æ®ºæŠ€",cost:40,desc:"æ•µå…¨ä½“ç‰¹å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸"}, desc:"ç”Ÿãã‚‹ä¼èª¬ã€‚", quotes:{atk:["æœªç†Ÿï¼","é…ã„"],skill:["ã“ã‚ŒãŒæ ¼ã®é•ã„ã ","ä¼èª¬ã‚’è¦‹ã›ã¦ã‚„ã‚ã†"],guard:["è¦‹åˆ‡ã£ãŸ"],win:["ã¾ã ã¾ã ã ãª"]} },
    ebi: { name:"ãˆã³ã¡ã‚Šï¼šãˆã³ã¡ã‚Š", stats:{str:6,int:8,agi:5}, skill1:{name:"æ¿€è¾›ã‚½ãƒ¼ã‚¹",cost:15,desc:"æ•µã«ç¶™ç¶šãƒ€ãƒ¡ãƒ¼ã‚¸(æ¯’)"}, skill2:{name:"ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ã‚¸ãƒ§ãƒ³",cost:35,desc:"æ•µå…¨ä½“ç‚ãƒ€ãƒ¡ãƒ¼ã‚¸"}, desc:"ãƒ”ãƒªãƒªã¨è¾›ã„ã€‚", quotes:{atk:["ç†±ã„ã‚ˆï¼","è¾›å£ã§ã„ãã‚ˆ"],skill:["ç‡ƒãˆä¸ŠãŒã‚Œï¼","æ¿€è¾›ã ãï¼"],guard:["æ®»ã«ç± ã‚‚ã‚‹"],win:["ãƒ›ãƒƒãƒˆã ã­ã‡"]} },
    fura: { name:"æ²–ç¸„çœŒæ°‘ï¼šãµã‚‰ãµã‚‰", stats:{str:5,int:6,agi:8}, skill1:{name:"ãªã‚“ãã‚‹ãªã„ã•",cost:20,desc:"å‘³æ–¹HPå›å¾©+çŠ¶æ…‹ç•°å¸¸æ²»ç™’"}, skill2:{name:"æŒ‡ç¬›",cost:20,desc:"å‘³æ–¹å…¨å“¡ã®ç´ æ—©ã•UP"}, desc:"æ™‚é–“ã¯å®ˆã‚‰ãªã„ã€‚", quotes:{atk:["ã„ãã•ãƒ¼","ãƒã‚¤ã‚µã‚¤"],skill:["ãªã‚“ã¨ã‹ãªã‚‹ã•ãƒ¼","è¸Šã‚ã†ï¼"],guard:["ã‚†ã£ãã‚Šã—ã‚ˆã†"],win:["ã‚ªãƒªã‚ªãƒ³ãƒ“ãƒ¼ãƒ«ã§ä¹¾æ¯ï¼"]} },
    tan: { name:"ãƒ‘ãƒ³ãƒ€ï¼šã‚¿ãƒ³ã‚¿ãƒ³", stats:{str:9,int:2,agi:5}, skill1:{name:"ç¬¹ã‚¢ã‚¿ãƒƒã‚¯",cost:10,desc:"ç‰©ç†å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸"}, skill2:{name:"ç™’ã‚„ã—ã®ãƒ¢ãƒ•ãƒ¢ãƒ•",cost:30,desc:"å‘³æ–¹å…¨å“¡HPå›å¾©"}, desc:"å¯æ„›ã„é¡”ã—ã¦å‡¶æš´ã€‚", quotes:{atk:["ã‚¢ãƒ¼ãƒ³ï¼","ãƒ‘ãƒ³ãƒï¼"],skill:["ç¬¹ãã‚Œï¼","è»¢ãŒã‚‹ãï¼"],guard:["å¯ã‚‹..."],win:["(ç¬¹ã‚’é£Ÿã¹ã¦ã„ã‚‹)"]} },
    tom: { name:"é—˜ç—…ä¸­ï¼šãƒˆãƒ ", stats:{str:3,int:9,agi:4}, skill1:{name:"ç‚¹æ»´ãƒ“ãƒ¼ãƒ ",cost:15,desc:"æ•µã®HPå¸å"}, skill2:{name:"é™¢å†…æ„ŸæŸ“",cost:40,desc:"æ•µå…¨ä½“ã«æ¯’+ç—…æ°—(å¼±ä½“)"}, desc:"ç—…é™¢ã‹ã‚‰ã®åˆºå®¢ã€‚", quotes:{atk:["æ³¨å°„ã—ã¾ã™","æ¶ˆæ¯’ã "],skill:["ãŠè–¬å‡ºã—ã¨ãã¾ã™","éš”é›¢ã—ã¾ã™"],guard:["å®‰é™ã«ã—ã¾ã™"],win:["é€€é™¢ã—ã¾ã™ï¼"]} },
    bull: { name:"å¤‰æ…‹ç´³å£«ï¼šãƒ–ãƒ«é–£ä¸‹", stats:{str:7,int:7,agi:4}, skill1:{name:"ç´³å£«ã®å—œã¿",cost:15,desc:"è‡ªåˆ†ã®æ”»æ’ƒUP"}, skill2:{name:"å¤‰æ…‹ã®æ¥µã¿",cost:50,desc:"è¶…æ¥µå¤§ãƒ€ãƒ¡ã ãŒè‡ªåˆ†ã‚‚ãƒ€ãƒ¡"}, desc:"ç´³å£«çš„ãªå¤‰æ…‹ã€‚", quotes:{atk:["ã”ãã’ã‚“ã‚ˆã†","å¤±æ•¬"],skill:["ç´ æ™´ã‚‰ã—ã„ï¼","èˆˆå¥®ã—ã¦ãã¾ã—ãŸï¼"],guard:["å†·é™ã«..."],win:["å®Ÿã«ç¾ã—ã„..."]} },
    deka: { name:"è‚‰ã†ã©ã‚“ï¼šãƒ‡ã‚«ç››ã‚Š", stats:{str:10,int:1,agi:3}, skill1:{name:"éººã‚¢ã‚¿ãƒƒã‚¯",cost:10,desc:"æ•µã‚’æ‹˜æŸ(æ•æ·ãƒ€ã‚¦ãƒ³)"}, skill2:{name:"ã‚«ãƒ­ãƒªãƒ¼çˆ†å¼¾",cost:30,desc:"æ•µå˜ä½“ã«è¶…ç‰¹å¤§ç‰©ç†ãƒ€ãƒ¡"}, desc:"åœ§å€’çš„ãƒœãƒªãƒ¥ãƒ¼ãƒ ã€‚", quotes:{atk:["å¤§ç››ã‚Šã ï¼","ã‚³ã‚·ãŒå‘½ï¼"],skill:["é£²ã¿å¹²ã—ã¦ã‚„ã‚‹","å¢—é‡ä¸­ï¼"],guard:["ä¼¸ã³ã¡ã‚ƒã†..."],win:["å®Œé£Ÿï¼"]} },
    aru: { name:"å½“ãŸã‚Šå¹´ï¼šã‚ã‚‹æ„å‘³", stats:{str:1,int:10,agi:8}, skill1:{name:"ä¸é‹ã®ä¼æŸ“",cost:15,desc:"æ•µã®å‘½ä¸­ç‡æ¿€æ¸›"}, skill2:{name:"å„è½ã¨ã—",cost:30,desc:"æ•µHP10%+ãƒ‡ãƒãƒ•è§£é™¤"}, desc:"æ­©ãå„å¹´ã€‚", quotes:{atk:["ã¾ãŸã‹...","å·»ãæ·»ãˆã "],skill:["ä¸å¹¸ã«ãªã‚ã‚Œ","ãŠè£¾åˆ†ã‘ã§ã™"],guard:["ä½•ã‚‚ã—ãŸããªã„"],win:["ç”Ÿãã¦ã¦ã‚ˆã‹ã£ãŸ"]} },
    mako: { name:"ãƒ¢ã‚¢ã‚¤æ„›å¥½å®¶ï¼šã¾ã“", stats:{str:8,int:4,agi:2}, skill1:{name:"çŸ³åƒå¬å–š",cost:20,desc:"å‘³æ–¹å…¨ä½“ã®é˜²å¾¡UP"}, skill2:{name:"ã‚¤ãƒ¼ã‚¹ã‚¿ãƒ¼ã®æ€’ã‚Š",cost:35,desc:"æ•µå…¨ä½“ã«åœ°å±æ€§å¤§ãƒ€ãƒ¡"}, desc:"å¿ƒã¯ã‚¤ãƒ¼ã‚¹ã‚¿ãƒ¼å³¶ã€‚", quotes:{atk:["ğŸ—¿ã‚¢ã‚¿ãƒƒã‚¯","ç¡¬ã„ã"],skill:["ğŸ—¿ãƒ“ãƒ¼ãƒ ï¼","ä¸¦ã³ãªã•ã„"],guard:["ğŸ—¿ã‚¬ãƒ¼ãƒ‰"],win:["ğŸ—¿..."]} },
    daime: { name:"ä»–è²¬ä¸»ç¾©ï¼šä»£åè©", stats:{str:5,int:5,agi:10}, skill1:{name:"è²¬ä»»è»¢å«",cost:10,desc:"è‡ªåˆ†ãŒå—ã‘ã‚‹ãƒ€ãƒ¡ã‚’æ•µã«è¿”ã™"}, skill2:{name:"äººã®ã›ã„",cost:20,desc:"æ•µã®æ”»æ’ƒå¯¾è±¡ã‚’ãƒ©ãƒ³ãƒ€ãƒ åŒ–"}, desc:"å…¨éƒ¨ã‚ã„ã¤ã®ã›ã„ã€‚", quotes:{atk:["ãŠå‰ã®ã›ã„ã ","çŸ¥ã‚‰ãªã„ã‚ˆ"],skill:["ä¿ºã˜ã‚ƒãªã„ï¼","ã‚ã„ã¤ãŒã‚„ã£ãŸ"],guard:["é–¢ä¿‚ãªã„ã­"],win:["ä¿ºã®ãŠã‹ã’ã "]} },
    chichi: { name:"æ¯å­ãƒ”ã‚¯ãƒŸãƒ³ï¼šã¡ã¡ã¡", stats:{str:2,int:8,agi:8}, skill1:{name:"å¼•ã£ã“æŠœã",cost:15,desc:"æ•µã®ãƒãƒ•ã‚’è§£é™¤"}, skill2:{name:"é‹æ¬",cost:25,desc:"å€’ã‚ŒãŸå‘³æ–¹1äººã‚’è˜‡ç”Ÿ"}, desc:"ã¤ã„ã¦ã„ãã¾ã™ã€‚", quotes:{atk:["ãˆã„ã£","æŠ•ã’ã‚‹ã‚ˆ"],skill:["é‹ã‚“ã§ï¼","å¢—ãˆã¾ã™"],guard:["åŸ‹ã¾ã‚‹"],win:["é£Ÿã¹ã‚‰ã‚Œãªãã¦ã‚ˆã‹ã£ãŸ"]} },
};

const SHOP_ITEMS = [
    { name: "æ „é¤Šãƒ‰ãƒªãƒ³ã‚¯", cost: 30, type: "item", effect: "heal_hp_100", desc:"HP100å›å¾©" },
    { name: "é­”æ³•ã®è–æ°´", cost: 50, type: "item", effect: "heal_mp_50", desc:"MP50å›å¾©" },
    { name: "ã‚¯ãƒ¬ãƒ¼ãƒ å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«", cost: 200, type: "equip", stat: "def", val: 5, desc:"é˜²å¾¡+5" },
    { name: "è»½é‡ã‚¹ãƒ‹ãƒ¼ã‚«ãƒ¼", cost: 200, type: "equip", stat: "spd", val: 5, desc:"ç´ æ—©ã•+5" },
    { name: "ãƒ–ãƒ©ãƒ³ãƒ‰æ™‚è¨ˆ", cost: 500, type: "equip", stat: "hp", val: 100, desc:"æœ€å¤§HP+100" },
    { name: "ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç«¯æœ«", cost: 500, type: "equip", stat: "mp", val: 50, desc:"æœ€å¤§MP+50" },
    { name: "ä¼èª¬ã®æ‹¡å£°å™¨", cost: 1000, type: "equip", stat: "atk", val: 20, desc:"æ”»æ’ƒ+20" },
    { name: "é­”å°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚¿", cost: 1000, type: "equip", stat: "matk", val: 20, desc:"é­”åŠ›+20" }
];

const ENEMIES = [
    { name: "é…å¸ƒç‰©ãªãã—é­”", hp: 100, atk: 12, exp: 20, gold: 30, msg: "ã€Œãƒ—ãƒªãƒ³ãƒˆï¼Ÿã‚ãƒ¼ã€ãƒ©ãƒ³ãƒ‰ã‚»ãƒ«ã®åº•ã§åŒ–çŸ³ã«ãªã£ã¦ã‚‹ã‹ã‚‚ï¼ã€" },
    { name: "å™‚å¥½ããƒœã‚¹ãƒãƒ", hp: 150, atk: 20, exp: 30, gold: 50, msg: "ã€Œã­ãˆèã„ãŸï¼Ÿ ã‚ã®å®¶ã®å¥¥ã•ã‚“ã€ã¾ãŸé€šè²©è²·ã£ã¦ãŸã‚ã‚ˆãƒ’ã‚½ãƒ’ã‚½â€¦ã€" },
    { name: "è«–ç ´ã—ãŸã„ãƒ‘ãƒ‘", hp: 250, atk: 30, exp: 50, gold: 80, msg: "ã€Œãã®æ„è¦‹ã®æ ¹æ‹ ã¯ï¼Ÿã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã¯ã‚ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã­ãˆï¼Ÿã€", type:"charge" },
    { name: "è¡Œäº‹å¼·åˆ¶å‚åŠ ãŠã°ã•ã‚“", hp: 400, atk: 45, exp: 80, gold: 120, msg: "ã€Œåœ°åŸŸã¨ã®çµ†ï¼çµ†ã‚ˆï¼å…¨å“¡å‚åŠ ãŒå¸¸è­˜ã§ã—ã‚‡ï¼ï¼Ÿã€" },
    { name: "å‰ä¾‹è¸è¥²ãƒ­ãƒœãƒƒãƒˆ", hp: 600, atk: 60, exp: 120, gold: 180, msg: "ã€Œå‰ä¾‹ã«ã‚ã‚Šã¾ã›ã‚“ã€‚å´ä¸‹ã—ã¾ã™ã€‚ã€", type:"def" },
    { name: "ITã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼é•·è€", hp: 900, atk: 80, exp: 200, gold: 250, msg: "ã€Œãƒ¡ãƒ¼ãƒ«ã ã®ãƒ©ã‚¤ãƒ³ã ã®åˆ†ã‹ã‚‰ã‚“ï¼é€£çµ¡ç¶²ã¯é›»è©±ã§å›ã›ï¼ã€" },
    { name: "æ„è­˜é«˜ã™ããƒ—ãƒ©ãƒ³ãƒŠãƒ¼", hp: 1300, atk: 100, exp: 300, gold: 350, msg: "ã€Œã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã®KPIã¨ã‚·ãƒŠã‚¸ãƒ¼åŠ¹æœã€ã‚¢ã‚¸ã‚§ãƒ³ãƒ€ã«å…¥ã£ã¦ã‚‹ï¼Ÿã€", type:"buff" },
    { name: "å››å¤©ç‹ï¼šãƒ™ãƒ«ãƒãƒ¼ã‚¯ã®å®ˆè­·è€…", hp: 1800, atk: 130, exp: 500, gold: 600, msg: "ã€Œ0.1ç‚¹ã®é‡ã¿ã‚’çŸ¥ã‚Œâ€¦ï¼åˆ‡ã‚Šæ–¹ãŒé›‘ãªã‚„ã¤ã¯è¨±ã•ã‚“ï¼ï¼ã€" },
    { name: "éŸ“å›½ãƒ‰ãƒ©ãƒå¥½ãï¼šã‚†ã†", hp: 3500, atk: 180, exp: 1200, gold: 1200, isBoss: true, msg: "ã€Œã‚ã€ãã®ãƒ‰ãƒ©ãƒï¼Ÿ ä¸»äººå…¬ã€è¨˜æ†¶å–ªå¤±ã«ãªã£ã¦å®Ÿã¯å…„å¦¹ã ã£ãŸã®ã‚ˆï½ï¼ã€" }, 
    { name: "PTAä¼šé•·ï¼šã¯ã¬ã¬", hp: 6500, atk: 250, exp: 0, gold: 0, isBoss: true, msg: "ã€Œã‚ã‚‰ï½ã€ã‚ˆãæ¥ãŸã‚ã­ï½â™¡ ãŠèŒ¶è“å­ç”¨æ„ã—ã¦ã‚‹ã‹ã‚‰ã€ã¡ã‚‡ã£ã¨åº§ã£ã¦ããªã•ã„ã‚ˆï½ã€" }
];

/* --- 2. ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç† --- */
const State = {
    party: [], 
    gold: 300,
    floor: 1,
    heroId: null,
    selectedAllies: [],
};

const Game = {
    toggleHelp: () => {
        const el = document.getElementById('modal-help');
        el.style.display = el.style.display === 'flex' ? 'none' : 'flex';
    },
    shuffle: (array) => {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    },
    toHeroSelect: () => {
        document.getElementById('screen-title').classList.remove('active');
        document.getElementById('screen-select-hero').classList.add('active');
        Game.renderCharSelect('hero');
    },
    renderCharSelect: (mode) => {
        const grid = document.getElementById(mode === 'hero' ? 'hero-select-grid' : 'party-select-grid');
        grid.innerHTML = '';
        
        let keys = Object.keys(ROLES);
        if (mode === 'hero') {
            const others = keys.filter(k => k !== 'nayuta');
            Game.shuffle(others);
            keys = ['nayuta', ...others];
        } else {
            keys = keys.filter(k => k !== State.heroId);
            Game.shuffle(keys);
        }

        keys.forEach(key => {
            const char = ROLES[key];
            const div = document.createElement('div');
            div.className = 'char-card';
            div.innerHTML = `
                <div style="font-weight:bold; color:var(--highlight-color);">${char.name}</div>
                <div style="font-size:0.85em; color:#ccc;">${char.desc}</div>
                <div style="font-size:0.8em; margin-top:3px;">
                    ç­‹:${char.stats.str} çŸ¥:${char.stats.int} æ•:${char.stats.agi}
                </div>
            `;
            div.onclick = () => mode === 'hero' ? Game.selectHero(key, div) : Game.selectAlly(key, div);
            grid.appendChild(div);
        });
    },
    selectHero: (key, el) => {
        document.querySelectorAll('#hero-select-grid .char-card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        State.heroId = key;
        document.getElementById('hero-confirm-btn').disabled = false;
    },
    confirmHero: () => {
        document.getElementById('screen-select-hero').classList.remove('active');
        document.getElementById('screen-select-party').classList.add('active');
        Game.renderCharSelect('party');
    },
    selectAlly: (key, el) => {
        if (State.selectedAllies.includes(key)) {
            State.selectedAllies = State.selectedAllies.filter(k => k !== key);
            el.classList.remove('selected');
        } else {
            if (State.selectedAllies.length < 2) {
                State.selectedAllies.push(key);
                el.classList.add('selected');
            }
        }
        const left = 2 - State.selectedAllies.length;
        document.getElementById('party-count-text').textContent = left === 0 ? "(æ±ºå®šå¯èƒ½)" : `(ã‚ã¨ ${left} å)`;
        document.getElementById('party-confirm-btn').disabled = (left !== 0);
    },
    confirmParty: () => {
        const allIds = [State.heroId, ...State.selectedAllies];
        State.party = allIds.map(key => {
            const base = ROLES[key];
            return {
                id: key,
                name: base.name,
                baseStats: { ...base.stats },
                addStats: { str:0, int:0, agi:0 },
                skill1: base.skill1,
                skill2: base.skill2,
                quotes: base.quotes || {atk:["ãŸãï¼"], skill:["ã„ããï¼"], guard:["å®ˆã‚‹ï¼"], win:["å‹åˆ©ï¼"]},
                hp: 0, maxHp: 0, mp: 0, maxMp: 0,
                atk: 0, matk:0, def: 0, spd: 0,
                pts: 5,
                buffs: {},
                equipment: []
            };
        });
        Game.recalcStats();
        Game.fullHeal();
        document.getElementById('screen-select-party').classList.remove('active');
        Game.toHub();
        setTimeout(Game.toggleHelp, 500);
    },
    recalcStats: () => {
        State.party.forEach(p => {
            const s = p.baseStats;
            const a = p.addStats;
            const tStr = s.str + a.str;
            const tInt = s.int + a.int;
            const tAgi = s.agi + a.agi;
            
            p.maxHp = 80 + (tStr * 15);
            p.maxMp = 40 + (tInt * 10);
            p.atk = 20 + (tStr * 3);
            p.matk = 20 + (tInt * 3);
            p.def = Math.floor(tStr * 1.5 + tInt * 0.5);
            p.spd = tAgi * 3;
            
            if(p.hp > p.maxHp) p.hp = p.maxHp;
            if(p.mp > p.maxMp) p.mp = p.maxMp;
        });
    },
    fullHeal: () => {
        State.party.forEach(p => { p.hp = p.maxHp; p.mp = p.maxMp; });
    },
    toHub: () => {
        document.getElementById('screen-battle').classList.remove('active');
        document.getElementById('screen-hub').classList.add('active');
        
        document.getElementById('floor-indicator').textContent = State.floor;
        document.getElementById('gold-display').textContent = State.gold;
        Game.renderHub();
    },
    renderHub: () => {
        const list = document.getElementById('hub-status-list');
        list.innerHTML = '';
        const shop = document.getElementById('shop-list');
        shop.innerHTML = '';

        State.party.forEach((p, idx) => {
            let html = `
                <div class="status-card">
                    <div style="display:flex; justify-content:space-between;">
                        <b style="color:${['#ff9999','#99ff99','#9999ff'][idx]}">${p.name}</b>
                        <span>Pt: <b class="c-yellow">${p.pts}</b></span>
                    </div>
                    <div style="font-size:0.85em; margin:5px 0;">
                        HP:${p.hp}/${p.maxHp} MP:${p.mp}/${p.maxMp} <br>
                        æ”»:${p.atk} é­”:${p.matk} é˜²:${p.def} é€Ÿ:${p.spd}
                    </div>
                    <div class="stat-btn-group">
                        <button onclick="Game.addStat(${idx},'str')" ${p.pts<=0?'disabled':''}>ç­‹ ${p.baseStats.str+p.addStats.str}</button>
                        <button onclick="Game.addStat(${idx},'int')" ${p.pts<=0?'disabled':''}>çŸ¥ ${p.baseStats.int+p.addStats.int}</button>
                        <button onclick="Game.addStat(${idx},'agi')" ${p.pts<=0?'disabled':''}>æ• ${p.baseStats.agi+p.addStats.agi}</button>
                    </div>
                </div>`;
            list.innerHTML += html;
        });

        SHOP_ITEMS.forEach((item, idx) => {
            const div = document.createElement('div');
            div.style.cssText = "display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px dotted #555; align-items:center;";
            div.innerHTML = `
                <div style="flex:1;"><div style="font-weight:bold;">${item.name}</div><small style="color:#aaa">${item.desc}</small></div>
                <button onclick="Game.buyItem(${idx})" ${State.gold < item.cost ? 'disabled' : ''} style="padding:8px 12px; margin:0; min-height:40px; white-space:nowrap;">${item.cost}G</button>
            `;
            shop.appendChild(div);
        });
    },
    addStat: (idx, type) => {
        const p = State.party[idx];
        if (p.pts > 0) {
            p.pts--;
            p.addStats[type]++;
            Game.recalcStats();
            if(type==='str') p.hp += 15;
            if(type==='int') p.mp += 10;
            Game.renderHub();
        }
    },
    buyItem: (idx) => {
        const item = SHOP_ITEMS[idx];
        if (State.gold >= item.cost) {
            State.gold -= item.cost;
            if (item.type === 'item') {
                State.party.forEach(p => {
                   if (item.effect.includes('hp')) p.hp = Math.min(p.maxHp, p.hp + 100); 
                   if (item.effect.includes('mp')) p.mp = Math.min(p.maxMp, p.mp + 50); 
                });
                alert("å…¨å“¡å›å¾©ã—ã¾ã—ãŸï¼");
            } else {
                State.party.forEach(p => {
                    if (item.stat === 'atk') p.addStats.str += 3;
                    if (item.stat === 'matk') p.addStats.int += 3;
                    if (item.stat === 'def') { p.addStats.str += 1; p.addStats.int += 1; }
                    if (item.stat === 'spd') p.addStats.agi += 2;
                    if (item.stat === 'hp') p.addStats.str += 5; 
                    if (item.stat === 'mp') p.addStats.int += 5;
                });
                Game.recalcStats();
                alert(`${item.name}ã‚’è³¼å…¥ï¼å…¨å“¡ã®èƒ½åŠ›ãŒå‘ä¸Šï¼`);
            }
            Game.toHub();
        }
    },
    showEncounter: () => {
        const floor = State.floor;
        if (floor > ENEMIES.length) return;
        const enemy = ENEMIES[floor - 1];
        
        document.getElementById('encounter-msg').textContent = enemy.msg;
        document.getElementById('encounter-enemy-name').textContent = `ç¾ã‚ŒãŸã®ã¯... ${enemy.name} !`;
        document.getElementById('modal-encounter').style.display = 'flex';
    }
};

/* --- 3. æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ  --- */
const Battle = {
    turnQueue: [],
    currentEnemy: null,
    activeCharIdx: -1,
    turnCount: 0,
    isProcessing: false,

    startCombat: () => {
        document.getElementById('modal-encounter').style.display = 'none';
        document.getElementById('screen-hub').classList.remove('active');
        document.getElementById('screen-battle').classList.add('active');
        
        Battle.turnCount = 1;
        Battle.isProcessing = false;
        document.getElementById('battle-log').innerHTML = '';
        
        const enemyData = ENEMIES[State.floor - 1];
        Battle.currentEnemy = { 
            ...enemyData, 
            maxHp: enemyData.hp,
            buffs: {}
        };
        
        Battle.log(`---------- æˆ¦é—˜é–‹å§‹ ----------`);
        Battle.updateUI();
        Battle.startRound();
    },
    log: (msg, quote = null) => {
        const el = document.getElementById('battle-log');
        const div = document.createElement('div');
        div.className = 'log-entry';
        div.innerHTML = msg;
        if (quote) {
            const qSpan = document.createElement('span');
            qSpan.className = 'log-quote';
            qSpan.textContent = quote;
            div.appendChild(qSpan);
        }
        el.appendChild(div);
        el.scrollTop = el.scrollHeight;
    },
    updateUI: () => {
        const e = Battle.currentEnemy;
        const pct = Math.max(0, (e.hp / e.maxHp) * 100);
        document.getElementById('enemy-hp').style.width = `${pct}%`;
        document.getElementById('enemy-name').textContent = e.name;
        document.getElementById('enemy-hp-text').textContent = `HP: ${Math.max(0, e.hp)} / ${e.maxHp}`;
        document.getElementById('turn-indicator').textContent = `Turn ${Battle.turnCount}`;

        const pPanel = document.getElementById('battle-party-status');
        pPanel.innerHTML = '';
        State.party.forEach((p,i) => {
            const isDead = p.hp <= 0;
            const isCurrent = Battle.turnQueue.length > 0 && Battle.turnQueue[0] === p;
            const border = isCurrent ? '2px solid yellow' : '1px solid #555';
            pPanel.innerHTML += `
                <div style="min-width:80px; background:#222; padding:3px; border:${border}; opacity:${isDead?0.5:1}; border-radius:4px;">
                    <div style="font-size:0.7em; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${p.name.split('ï¼š')[1]}</div>
                    <div style="height:4px; background:#555; width:100%;"><div style="height:100%; background:#e74c3c; width:${Math.max(0,(p.hp/p.maxHp)*100)}%"></div></div>
                    <div style="height:4px; background:#555; width:100%; margin-top:1px;"><div style="height:100%; background:#3498db; width:${Math.max(0,(p.mp/p.maxMp)*100)}%"></div></div>
                </div>`;
        });
    },
    startRound: () => {
        let entities = [...State.party.filter(p=>p.hp>0), Battle.currentEnemy];
        entities.sort((a, b) => {
            const spdA = (a.spd || (a.isBoss ? 50 : 15)) + Math.random() * 10;
            const spdB = (b.spd || (b.isBoss ? 50 : 15)) + Math.random() * 10;
            return spdB - spdA;
        });
        Battle.turnQueue = entities;
        Battle.nextTurn();
    },
    nextTurn: () => {
        if (Battle.isProcessing) return;

        if (Battle.checkWinLose()) return;
        
        if (Battle.turnQueue.length === 0) {
            Battle.turnCount++;
            Battle.startRound();
            return;
        }

        const actor = Battle.turnQueue.shift();
        Battle.updateUI();

        if (actor.hp <= 0) { 
            Battle.nextTurn(); 
            return; 
        }
        
        // ã‚¬ãƒ¼ãƒ‰çŠ¶æ…‹è§£é™¤
        if (actor.buffs && actor.buffs['guard']) {
            delete actor.buffs['guard'];
        }

        if (actor === Battle.currentEnemy) {
            Battle.isProcessing = true;
            setTimeout(() => {
                Battle.enemyAction();
                Battle.isProcessing = false;
                setTimeout(Battle.nextTurn, 600);
            }, 600);
        } else {
            document.getElementById('command-panel').style.display = 'grid';
            document.getElementById('active-char-name').textContent = actor.name;
            
            const btn1 = document.getElementById('btn-skill1');
            const btn2 = document.getElementById('btn-skill2');
            
            // ã‚ã£ããƒ¼ã®ã‚¹ã‚­ãƒ«1ã‚³ã‚¹ãƒˆè¡¨ç¤ºä¿®æ­£
            const costUnit = actor.id === 'akki' ? 'G' : 'MP';
            const costVal = actor.id === 'akki' ? 50 : actor.skill1.cost;
            
            btn1.textContent = `${actor.skill1.name} (${costVal}${costUnit})`;
            
            // éš ã—ã‚¹ã‚­ãƒ«åˆ¤å®šï¼ˆåˆè¨ˆå€¤ã‚’ãƒã‚§ãƒƒã‚¯ï¼‰
            const totalStr = actor.baseStats.str + actor.addStats.str;
            const totalInt = actor.baseStats.int + actor.addStats.int;
            const totalAgi = actor.baseStats.agi + actor.addStats.agi;
            
            const skillUnlocked = totalStr >= UNLOCK_THRESHOLD || totalInt >= UNLOCK_THRESHOLD || totalAgi >= UNLOCK_THRESHOLD;
            if (skillUnlocked) {
                btn2.style.display = 'block';
                btn2.textContent = `${actor.skill2.name} (â˜…)`;
                btn2.disabled = false;
            } else {
                btn2.style.display = 'none';
            }
            
            Battle.activeCharIdx = State.party.indexOf(actor);
            window.scrollTo(0, document.body.scrollHeight);
        }
    },
    action: (type) => {
        if (Battle.isProcessing) return;
        
        const actor = State.party[Battle.activeCharIdx];
        const enemy = Battle.currentEnemy;
        document.getElementById('command-panel').style.display = 'none';
        Battle.isProcessing = true;

        let msg = "";
        let quote = "";
        const getRandomQuote = (cat) => {
            const quotes = actor.quotes[cat];
            return quotes ? quotes[Math.floor(Math.random() * quotes.length)] : "";
        };

        if (type === 'attack') {
            const dmg = Math.floor(actor.atk * (0.8 + Math.random()*0.4));
            enemy.hp -= dmg;
            msg = `<b>${actor.name}</b>ã®æ”»æ’ƒï¼ <span class="c-red">${dmg}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼</span>`;
            if(dmg > actor.atk * 1.1) msg += " <span class='c-yellow'>(ä¼šå¿ƒ!)</span>";
            quote = getRandomQuote('atk');

        } else if (type === 'guard') {
            actor.buffs['guard'] = true;
            const rec = Math.floor(actor.maxMp * 0.1) + 5;
            actor.mp = Math.min(actor.maxMp, actor.mp + rec);
            msg = `<b>${actor.name}</b>ã¯é›†ä¸­ã—ã¦é˜²å¾¡ï¼ MPãŒ<span class="c-blue">${rec}</span>å›å¾©ï¼`;
            quote = getRandomQuote('guard');

        } else if (type === 'skill1' || type === 'skill2') {
            const skill = (type === 'skill1') ? actor.skill1 : actor.skill2;
            let canUse = true;

            // ã‚³ã‚¹ãƒˆæ”¯æ‰•ã„åˆ¤å®š
            if (actor.id === 'akki') {
                const cost = (type === 'skill1') ? 50 : 0;
                if (State.gold < cost) {
                    alert("ãŠé‡‘ãŒè¶³ã‚Šãªã„ï¼"); 
                    canUse = false;
                } else {
                    State.gold -= cost;
                }
            } else {
                if (actor.mp < skill.cost) {
                    alert("MPãŒè¶³ã‚Šãªã„ï¼"); 
                    canUse = false;
                } else {
                    actor.mp -= skill.cost;
                }
            }

            if (!canUse) {
                document.getElementById('command-panel').style.display = 'grid';
                Battle.isProcessing = false;
                return;
            }
            
            quote = getRandomQuote('skill');
            
            // ã‚¹ã‚­ãƒ«åŠ¹æœå‡¦ç†
            if (skill.type === 'heal' || skill.name.includes("å›å¾©") || skill.name.includes("ã‚¹ãƒã‚¤ãƒ«")) {
                let heal = actor.matk * 3;
                if (skill.name.includes("å®Œå…¨")) heal = 9999;
                if (skill.name.includes("ã‚¹ãƒã‚¤ãƒ«")) heal = 50;
                State.party.forEach(p => { if(p.hp>0) p.hp = Math.min(p.maxHp, p.hp + heal); });
                msg = `<b>${actor.name}</b>ã®${skill.name}ï¼ å…¨å“¡ã®HPãŒå›å¾©ã—ãŸï¼`;
                if(skill.name.includes("ã‚¹ãƒã‚¤ãƒ«")) {
                    State.party.forEach(p => p.mp = Math.min(p.maxMp, p.mp + 20));
                    msg += " (MPã‚‚å°‘ã—å›å¾©)";
                }

            } else if (skill.type === 'support' || skill.name.includes("UP") || skill.name.includes("å·ä»¤")) {
                msg = `<b>${actor.name}</b>ã®${skill.name}ï¼ `;
                if (skill.name === "ã‚®ã‚¬ãƒ™ãƒ¼ãƒ«") {
                    State.party.forEach(p => p.buffs['invincible'] = true);
                    msg = `<b>${actor.name}</b>ã®${skill.name}ï¼ å…¨å“¡ç„¡æ•µã«ãªã£ãŸï¼`;
                } else {
                    State.party.forEach(p => p.atk += 5);
                    msg += "å‘³æ–¹ã®å£«æ°—ãŒé«˜ã¾ã£ãŸï¼";
                }

            } else {
                // æ”»æ’ƒç³»ã‚¹ã‚­ãƒ«
                let multiplier = (type === 'skill2') ? 4.0 : 2.0;
                let dmg = Math.floor((actor.atk + actor.matk) * multiplier);
                
                if (actor.id === 'akki' && type === 'skill1') dmg = 150;
                
                enemy.hp -= dmg;
                msg = `<b>${actor.name}</b>ã®${skill.name}ï¼ ã‚ºãƒ‰ãƒ¼ãƒ³ï¼ <span class="c-red">${dmg}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼</span>`;
                
                if(actor.id === 'akki' && type === 'skill1') {
                    msg = `${actor.name}ãŒãƒãƒ†ãƒˆã‚’ä¹±ã‚ŒæŠ•ã’ï¼ <span class="c-red">150ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼</span>`;
                }
            }
        }

        Battle.log(msg, quote);
        Battle.updateUI();
        document.getElementById('gold-display').textContent = State.gold;
        
        setTimeout(() => {
            Battle.isProcessing = false;
            Battle.nextTurn();
        }, 800);
    },
    enemyAction: () => {
        const e = Battle.currentEnemy;
        const targets = State.party.filter(p => p.hp > 0);
        if (targets.length === 0) return;
        const target = targets[Math.floor(Math.random() * targets.length)];

        let actionType = "attack";
        if (e.type === 'charge' && Math.random() < 0.3) actionType = "charge";
        else if (e.hp < e.maxHp * 0.3 && Math.random() < 0.4) actionType = "heal";
        else if (Math.random() < 0.2) actionType = "special";

        let dmg = Math.max(1, e.atk - Math.floor(target.def/2));
        let msg = "";

        if (actionType === "charge") {
            if (!e.buffs) e.buffs = {};
            e.buffs['charged'] = true;
            msg = `${e.name}ã¯é¡”ã‚’çœŸã£èµ¤ã«ã—ã¦æ€’ã‚Šã‚’æºœã‚ã¦ã„ã‚‹â€¦ï¼`;
        } 
        else if (actionType === "heal") {
            const heal = Math.floor(e.maxHp * 0.2);
            e.hp = Math.min(e.maxHp, e.hp + heal);
            msg = `${e.name}ã¯è¨€ã„è¨³ã‚’ã—ã¦è‡ªåˆ†ã‚’æ­£å½“åŒ–ã—ãŸï¼ HPãŒ${heal}å›å¾©ï¼`;
        }
        else if (actionType === "special") {
            dmg = Math.floor(dmg * 1.5);
            if (target.buffs['invincible']) dmg = 0;
            target.hp -= dmg;
            msg = `${e.name}ã®å¿…æ®ºè©±è¡“ï¼ã€Œ${e.msg.replace(/ã€Œ|ã€/g, '')}"<br>${target.name}ã«ç²¾ç¥çš„<span class="c-red">${dmg}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼</span>`;
        }
        else {
            // é€šå¸¸æ”»æ’ƒ
            if (e.buffs && e.buffs.charged) {
                dmg = Math.floor(dmg * 2.5);
                msg = `æºœã‚æ”»æ’ƒãŒç‚¸è£‚ï¼ ãƒ‰ã‚«ãƒ³ï¼ï¼ `;
                delete e.buffs.charged;
            } else {
                msg = `${e.name}ã®æ”»æ’ƒï¼ `;
            }

            if (target.buffs['invincible']) {
                dmg = 0;
                msg += `${target.name}ã«ã¯åŠ¹ã‹ãªã„ï¼`;
            } else if (target.buffs['guard']) {
                dmg = Math.floor(dmg * 0.4);
                msg += `${target.name}ã¯ã‚¬ãƒ¼ãƒ‰ã—ã¦<span class="c-red">${dmg}ãƒ€ãƒ¡ãƒ¼ã‚¸</span>ã«æŠ‘ãˆãŸï¼`;
            } else {
                msg += `${target.name}ã«<span class="c-red">${dmg}ãƒ€ãƒ¡ãƒ¼ã‚¸</span>ï¼`;
            }
            target.hp -= dmg;
        }

        Battle.log(msg);
        Battle.updateUI();
    },
    checkWinLose: () => {
        const allEnemyDefeated = Battle.currentEnemy.hp <= 0;
        const allPlayerDefeated = State.party.every(p => p.hp <= 0);

        if (allEnemyDefeated) {
            if (State.floor >= ENEMIES.length) {
                Battle.log(`---------- ${Battle.currentEnemy.name} ã‚’æ‰“ã¡å€’ã—ãŸï¼ ----------`);
                setTimeout(() => {
                    Game.showEnding();
                }, 800);
                return true;
            } else {
                Battle.log(`ğŸ‰ <span class="c-green"><b>${Battle.currentEnemy.name}ã‚’å€’ã—ãŸï¼</b></span>`);
                setTimeout(() => {
                    const reward = Battle.currentEnemy.gold;
                    State.gold += reward;
                    State.party.forEach(p => { if(p.hp>0) p.pts += 4; });
                    State.floor++;
                    alert(`å‹åˆ©ï¼\næ´»å‹•è³‡é‡‘ ${reward}G ã‚’ç²å¾—ï¼`);
                    // Game.fullHeal(); HP/MPã¯è‡ªç„¶ã«æ¸›ã£ãŸã¾ã¾ã«ã™ã‚‹
                    Game.toHub();
                }, 800);
                return true;
            }
        }

        if (allPlayerDefeated) {
            Battle.log(`ğŸ’€ <span class="c-red"><b>å…¨æ»…ã—ã¾ã—ãŸ...</b></span>`);
            setTimeout(() => {
                alert("å…¨æ»…ã—ã¾ã—ãŸ...\nå†æŒ‘æˆ¦ã—ã¾ã™ã€‚");
                Game.fullHeal();
                Game.toHub();
            }, 800);
            return true;
        }

        return false;
    }
};

/* --- ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚° --- */
Game.showEnding = () => {
    document.getElementById('screen-battle').classList.remove('active');
    document.getElementById('modal-ending').style.display = 'flex';

    const text = document.getElementById('ending-text');
    
    const winningParty = State.party.filter(p => p.hp > 0);
    const hero = winningParty.find(p => p.id === State.heroId) || winningParty[0];
    const commentChar = winningParty[Math.floor(Math.random() * winningParty.length)];

    let endingText = `
æ¿€ã—ã„è­°è«–(ãƒãƒˆãƒ«)ã®æœ«ã€PTAä¼šé•·ï¼šã¯ã¬ã¬ã¯å„ªé›…ã«ãƒ†ã‚£ãƒ¼ã‚«ãƒƒãƒ—ã‚’ç½®ã„ãŸã€‚
    
ã¯ã¬ã¬ã€Œã‚ã‚‰ï½ã€ã‚ãªãŸãŸã¡å‡„ã„ã˜ã‚ƒãªã„ã®ï½ã€‚
ã“ã‚“ãªã«ç†±å¿ƒãªäººãŸã¡ã€ä¹…ã—ã¶ã‚Šã«è¦‹ãŸã‚ï½ã€
    
é­”ç‹ã¨æã‚Œã‚‰ã‚ŒãŸå½¼å¥³ã¯ã€å®Ÿã¯ãŸã ã®ã€Œã‚«ãƒªã‚¹ãƒã™ãã‚‹PTAä¼šé•·ã€ã ã£ãŸã®ã ã€‚
ãã®çµ±ç‡åŠ›ã¨ç¾è²Œã€ãã—ã¦ç‹¬ç‰¹ã®å£èª¿ãŒã€
å°¾ã²ã‚Œã‚’ã¤ã‘ã¦é­”ç‹ä¼èª¬ã¨ã—ã¦åºƒã¾ã£ã¦ã„ãŸã ã‘ã ã£ãŸã€‚

${hero.name.split('ï¼š')[1]}ã€Œï¼ˆ...çµå±€ã€ç§ãŸã¡ã¯ä½•ã‚’ã—ã¦ã„ãŸã‚“ã ï¼Ÿï¼‰ã€
    
ã¯ã¬ã¬ã€Œç§ãŒã€é­”ç‹ã€ã ãªã‚“ã¦ã€ã¿ã‚“ãªå†—è«‡ãŒä¸Šæ‰‹ãªã‚“ã ã‹ã‚‰ï½ã€‚
ã•ã€ç¾å‘³ã—ã„ã‚±ãƒ¼ã‚­ãŒã‚ã‚‹ã®ã‚ˆã€‚é£Ÿã¹ã¦ã„ããªã•ã„ãªï½ã€
    
---

ã€å€‹ã€…ã®å‹‡è€…ãŸã¡ã®åå¿œã€‘

* **ãƒãƒƒã‚¯ç”·ï¼šã‚ã£ããƒ¼**ã¯ã€å·®ã—å‡ºã•ã‚ŒãŸé«˜ç´šãªã‚±ãƒ¼ã‚­ã§ã¯ãªãã€
ã¯ã¬ã¬ä¼šé•·ã®ãƒãƒƒã‚°ã‹ã‚‰è¦—ã**ãƒã‚¯ãƒ‰ãƒŠãƒ«ãƒ‰ã®ç´™è¢‹**ã«æ°—ã¥ãã€
é™ã‹ã«æ¶™ã‚’æµã—ãŸã€‚

* **ç­‹è‚‰æˆ¦å£«ï¼šYJ**ã¯ã€Œé­”ç‹ã®ç­‹è‚‰â€¦ã™ã€å‡„ã„ï¼ã€ã¨ã€
æˆ¦ã„ä»¥å¤–ã®å ´æ‰€ã§æ„ŸéŠ˜ã‚’å—ã‘ã¦ã„ã‚‹ã€‚

* **é£Ÿã„ã—ã‚“åŠï¼šã“ã“ãª**ã¯ã€ã‚±ãƒ¼ã‚­ã‚’å‰ã«ã—ã¦æ—¢ã«æˆ¦é—˜ã‚’å†é–‹ã—ã¦ãŠã‚Šã€
ã¯ã¬ã¬ä¼šé•·ã‚‚æ€ã‚ãšã€Œã‚ã‚‰ã‚ã‚‰ã€ã¨å¾®ç¬‘ã‚“ã ã€‚

* ${commentChar.name.split('ï¼š')[1]}ã€Œ${commentChar.quotes.win[Math.floor(Math.random()*commentChar.quotes.win.length)]}ã€
    
---
    
ã¯ã¬ã¬ã®åº•çŸ¥ã‚Œã¬åŒ…å®¹åŠ›(ã¨é«˜ç´šãªãŠè“å­)ã®å‰ã«ã€å‹‡è€…ãŸã¡ã¯æˆ¦æ„ã‚’å–ªå¤±ã—ãŸã€‚
ã“ã†ã—ã¦ã€åœ°åŸŸã®èª¤è§£ã¯è§£ã‘ã€æœ€å¼·ã®PTAãŒèª•ç”Ÿã—ãŸã®ã ã£ãŸã€‚

æœ¬å½“ã«å¤§åˆ‡ãªã®ã¯ã€è­°è«–ã§ã¯ãªãã€ç¹‹ãŒã‚Šã ã£ãŸã®ã‹ã‚‚ã—ã‚Œãªã„ã€‚
    
**SPECIAL THANKS!**
${State.party.map(p => p.name.split('ï¼š')[1]).join(' / ')}

~ THE END ~
`;
    text.textContent = endingText.trim();
};

// åˆæœŸåŒ–
window.onload = () => {
    document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
    document.getElementById('screen-title').classList.add('active');
};
</script>
</body>
</html>
