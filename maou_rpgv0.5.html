<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ã¯ã¬ã¬ã‚“ã‚¯ã‚¨ã‚¹ãƒˆ ï½PTAãªå‹‡è€…ãŸã¡ï½ Ver.0.5</title>
<style>
    :root {
        --bg-color: #212529;
        --panel-bg: #343a40;
        --text-color: #f8f9fa;
        --accent-color: #e74c3c;
        --highlight-color: #f1c40f;
        --btn-bg: #495057;
        --border-color: #6c757d;
        --log-bg: rgba(0,0,0,0.6);
    }
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        min-height: 100vh;
        touch-action: manipulation; 
    }
    #game-container {
        width: 100%;
        max-width: 600px;
        background-color: var(--panel-bg);
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
        min-height: 100vh;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    
    h1, h2, h3 { text-align: center; margin: 10px 0; color: var(--highlight-color); text-shadow: 1px 1px 2px #000; }
    button {
        background-color: var(--btn-bg);
        color: #fff;
        border: 1px solid #adb5bd;
        padding: 12px;
        margin: 4px;
        cursor: pointer;
        border-radius: 8px;
        font-weight: bold;
        font-size: 1rem;
        transition: background 0.1s;
        min-height: 48px;
    }
    button:active:not(:disabled) { background-color: #ced4da; color: #000; transform: translateY(2px); }
    button:disabled { 
        opacity: 0.4; 
        cursor: not-allowed; 
        transform: none;
        background-color: #6c757d;
    }
    
    .screen { display: none; padding: 15px; animation: fadeIn 0.3s; padding-bottom: 80px; }
    .active { display: block !important; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .char-grid { 
        display: grid; 
        grid-template-columns: repeat(2, 1fr);
        gap: 8px; 
    }
    .char-card { 
        border: 2px solid var(--border-color); 
        background: rgba(255,255,255,0.05);
        padding: 8px; 
        cursor: pointer; 
        border-radius: 8px;
        font-size: 0.9rem;
        transition: all 0.2s;
    }
    .char-card:active {
        transform: scale(0.98);
    }
    .char-card.selected { 
        border-color: var(--highlight-color); 
        background-color: rgba(241, 196, 15, 0.2); 
        box-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
    }
    
    .status-card {
        background: rgba(0,0,0,0.3);
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 8px;
        font-size: 0.9rem;
    }
    .stat-btn-group { display: flex; gap: 5px; margin-top: 5px; }
    .stat-btn-group button { flex: 1; padding: 5px; font-size: 0.8rem; min-height: 35px; }

    .skill-info {
        background: rgba(0,0,0,0.5);
        padding: 6px 8px;
        margin-top: 6px;
        border-left: 3px solid var(--highlight-color);
        font-size: 0.8em;
        line-height: 1.4;
    }
    .skill-info-title {
        font-weight: bold;
        color: var(--highlight-color);
        margin-bottom: 2px;
    }
    .skill-info-desc {
        color: #ccc;
    }
    .skill-hint {
        color: #888;
        font-style: italic;
        font-size: 0.85em;
    }

    #battle-area {
        display: flex;
        flex-direction: column;
        height: 100vh;
        padding: 0;
    }
    #battle-header {
        padding: 10px;
        background: rgba(0,0,0,0.2);
    }
    #battle-visual {
        text-align: center;
        margin: 10px 0;
    }
    #battle-log {
        flex: 1;
        overflow-y: auto;
        background: var(--log-bg);
        border-top: 2px solid var(--border-color);
        padding: 10px;
        font-size: 0.95rem;
        font-family: sans-serif;
        line-height: 1.4;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        scroll-behavior: smooth;
    }
    .log-entry { 
        margin-bottom: 6px; 
        border-bottom: 1px dashed rgba(255,255,255,0.1); 
        padding-bottom: 2px; 
    }
    .log-quote { 
        color: #aaa; 
        font-style: italic; 
        font-size: 0.85em; 
        display: block; 
        margin-top: 2px; 
    }
    
    #command-panel {
        background: #222;
        padding: 10px;
        border-top: 2px solid var(--highlight-color);
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 5px;
        padding-bottom: 20px;
    }
    #command-panel button { margin: 0; width: 100%; }
    .btn-skill-2 { 
        background-color: #8e44ad; 
        border-color: #9b59b6; 
        color: #fff; 
        box-shadow: 0 0 5px #9b59b6; 
    }

    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); z-index: 100;
        display: none; align-items: center; justify-content: center;
        padding: 20px; box-sizing: border-box;
    }
    .modal-content {
        background: var(--panel-bg); border: 2px solid var(--highlight-color);
        padding: 20px; width: 100%; max-width: 500px;
        border-radius: 10px; text-align: center;
        max-height: 90vh; overflow-y: auto;
    }
    
    .bar-container { width: 100%; background: #555; height: 10px; border-radius: 5px; margin: 3px 0; overflow: hidden; }
    .hp-bar { height: 100%; background: #e74c3c; width: 100%; transition: width 0.3s; }
    .mp-bar { height: 100%; background: #3498db; width: 100%; transition: width 0.3s; }

    .c-yellow { color: var(--highlight-color); }
    .c-red { color: #e74c3c; }
    .c-green { color: #2ecc71; }
    .c-blue { color: #3498db; }
    .c-purple { color: #9b59b6; }

    .help-button {
        position: fixed;
        bottom: 10px;
        right: 10px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: var(--highlight-color);
        color: #000;
        border: none;
        font-weight: bold;
        font-size: 1.5rem;
        cursor: pointer;
        z-index: 99;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        transition: all 0.2s;
    }
    .help-button:active {
        transform: scale(0.9);
    }
</style>
</head>
<body>

<div id="game-container">
    <div id="screen-title" class="screen active" style="text-align:center;">
        <h1 style="font-size:2.2rem; margin-top:50px;">ã¯ã¬ã¬ã‚“<br>ã‚¯ã‚¨ã‚¹ãƒˆ</h1>
        <h3 style="color:#fff;">Ver 0.5</h3>
        <p>PTAãªå‹‡è€…ãŸã¡ã¨æŒ‘ã‚€<br>åœ°åŸŸå¯†ç€å‹RPG</p>
        <button onclick="Game.toHeroSelect()" style="width:80%; margin-top:30px; font-size:1.2rem;">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button onclick="Game.toggleHelp()" style="width:80%; margin-top:10px;">ãƒ˜ãƒ«ãƒ— / æ”»ç•¥æƒ…å ±</button>
    </div>

    <div id="screen-select-hero" class="screen">
        <h2>ä¸»äººå…¬ã‚’é¸æŠ</h2>
        <div id="hero-select-grid" class="char-grid"></div>
        <div style="position:sticky; bottom:0; background:var(--panel-bg); padding:10px; text-align:center; border-top:1px solid #555;">
            <button id="hero-confirm-btn" onclick="Game.confirmHero()" disabled style="width:100%;">ã“ã®ã‚­ãƒ£ãƒ©ã§æ±ºå®š</button>
        </div>
    </div>

    <div id="screen-select-party" class="screen">
        <h2>ä»²é–“ã‚’2åé¸æŠ <span id="party-count-text" style="font-size:0.8em;">(ã‚ã¨2å)</span></h2>
        <div id="party-select-grid" class="char-grid"></div>
        <div style="position:sticky; bottom:0; background:var(--panel-bg); padding:10px; text-align:center; border-top:1px solid #555;">
            <button id="party-confirm-btn" onclick="Game.confirmParty()" disabled style="width:100%;">çµæˆå®Œäº†ï¼</button>
        </div>
    </div>

    <div id="screen-hub" class="screen">
        <h3>ä¼šè­°å®¤ (ç¬¬<span id="floor-indicator">1</span>éšå±¤)</h3>
        
        <div id="hub-status-list"></div>

        <div style="margin-top:20px; border-top:1px dashed #777; padding-top:10px;">
            <h4>ãƒã‚¶ãƒ¼ (æ‰€æŒé‡‘: <span id="gold-display">0</span>G)</h4>
            <div id="shop-list"></div>
        </div>

        <div style="text-align:center; margin-top:30px;">
            <button onclick="Game.showEncounter()" style="width:100%; background:#d35400; font-size:1.2rem;">>> ä¼šè­°ã«å‡ºå¸­ã™ã‚‹ <<</button>
        </div>
    </div>

    <div id="screen-battle" class="screen" style="padding:0; display:none;">
        <div id="battle-area">
            <div id="battle-header">
                <div id="turn-indicator" style="font-size:0.8em; color:#ccc; text-align:center;">è­°é¡Œ 1</div>
                <div class="enemy-display">
                    <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                        <span id="enemy-name" style="font-size:1.2em; font-weight:bold; color:#e74c3c;">è­°é¡Œæèµ·è€…</span>
                        <span id="enemy-hp-text" style="font-size:0.8em;">èª¬å¾—åº¦: ???</span>
                    </div>
                    <div class="bar-container"><div id="enemy-hp" class="hp-bar"></div></div>
                </div>
                <div id="battle-party-status" style="display:flex; gap:5px; margin-top:10px; overflow-x:auto;"></div>
            </div>

            <div id="battle-log"></div>

            <div id="command-panel" style="display:none;">
                <div style="grid-column: 1 / -1; text-align:center; margin-bottom:5px; color:#fff;">
                    <span id="active-char-name" style="font-weight:bold;"></span> ã®ç•ª
                </div>
                <button onclick="Battle.action('attack')">ç™ºè¨€</button>
                <button onclick="Battle.action('guard')">å‚¾è´/ãƒ¡ãƒ¢</button>
                <button onclick="Battle.action('skill1')" id="btn-skill1" class="c-yellow">ã‚¹ã‚­ãƒ«</button>
                <button onclick="Battle.action('skill2')" id="btn-skill2" class="btn-skill-2" style="display:none;">â˜…ãƒ¬ã‚¢</button>
            </div>
        </div>
    </div>

    <div id="modal-encounter" class="modal-overlay">
        <div class="modal-content">
            <h2 class="c-red">è­°é¡ŒãŒæèµ·ã•ã‚Œã¾ã—ãŸï¼</h2>
            <div id="encounter-msg" style="font-style:italic; margin:20px 0; font-size:1.1em;"></div>
            <p id="encounter-enemy-name" style="font-weight:bold;"></p>
            <button onclick="Battle.startCombat()" style="width:80%; background:#e74c3c;">ä¼šè­°é–‹å§‹ï¼</button>
        </div>
    </div>

    <div id="modal-help" class="modal-overlay" onclick="Game.toggleHelp()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3>ğŸ”° PTAå‹‡è€…ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</h3>
            <ul style="text-align:left; padding-left:20px; font-size:0.9em; line-height:1.8;">
                <li><b>ç›®çš„:</b> å…¨10éšå±¤ã«å­˜åœ¨ã™ã‚‹åœ°åŸŸã®ã€Œå›°ã£ãŸäººãŸã¡ã€ã‚’èª¬å¾—ã—ã€ä¼šé•·ã¯ã¬ã¬ã¨å¯¾è©±ã™ã‚‹ã“ã¨ã€‚</li>
                <li><b>æˆé•·:</b> ä¼šè­°ã‚’ä¹—ã‚Šè¶Šãˆã‚‹ã¨Ptç²å¾—ã€‚ã€Œä¼šè­°å®¤ã€ã§èƒ½åŠ›ã«æŒ¯ã‚Šåˆ†ã‘ã¦ãã ã•ã„ã€‚
                    <br>ãƒ»<b>ç­‹åŠ›:</b> ç™ºè¨€åŠ›ãƒ»é˜²å¾¡UP (ç‰©ç†å‘ã‘) / ä½“åŠ›+15
                    <br>ãƒ»<b>çŸ¥åŠ›:</b> æ°—åŠ›ãƒ»èª¬å¾—åŠ›UP (çŸ¥æ€§å‘ã‘) / æ°—åŠ›+10
                    <br>ãƒ»<b>æ•æ·:</b> ç™ºè¨€é †ãƒ»å›é¿UP (å…¨å“¡ã«é‡è¦)
                </li>
                <li><b>â˜…ãƒ¬ã‚¢ã‚¹ã‚­ãƒ«:</b> å„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«ã¯æ¡ä»¶ã‚’æº€ãŸã™ã“ã¨ã§è§£ç¦ã•ã‚Œã‚‹<b>ãƒ¬ã‚¢ã‚¹ã‚­ãƒ«</b>ãŒã‚ã‚Šã¾ã™ã€‚
                    <br>ãã®æ¡ä»¶ã¯ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ã‚¿ã‚¤ãƒ—ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã€‚
                    <br>ã€Œå¼·ã•ã®è¿½æ±‚ã€ã€Œé€Ÿã•ã®æ¥µè‡´ã€ã€ŒçŸ¥è­˜ã®æ·±åŒ–ã€...
                    <br>ã‚ã‚‹ã„ã¯ã€Œå…¨æ–¹ä½ã®é›éŒ¬ã€ãŒå¿…è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
                </li>
                <li><b>ãƒãƒƒã‚¯ç”·ã®ä»•æ§˜:</b> æ°—åŠ›ã§ã¯ãªãã€Œæ‰€æŒé‡‘ã€ã‚’æ¶ˆè²»ã—ã¦æ´»å‹•ã—ã¾ã™ã€‚</li>
                <li><b>å‚¾è´/ãƒ¡ãƒ¢:</b> ç›¸æ‰‹ã®è©±ã‚’èãã€æ°—åŠ›ãŒå›å¾©ã—ã¾ã™ã€‚</li>
                <li><b>æ³¨æ„:</b> ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¡ãƒ³ãƒãƒ¼ãŒå…¨å“¡ç–²å¼Šã™ã‚‹ã¨æ•—åŒ—ã§ã™ã€‚</li>
            </ul>
            <button onclick="Game.toggleHelp()" style="margin-top:15px; width:100%;">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    
    <div id="modal-ending" class="modal-overlay">
        <div class="modal-content">
            <h1>ğŸ  MISSION COMPLETE! ğŸ </h1>
            <div id="ending-text" style="white-space: pre-wrap; line-height: 1.6; text-align:left; font-size:0.9em; max-height:70vh; overflow-y:auto;"></div>
            <button onclick="location.reload()" style="margin-top:20px; width:100%;">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
        </div>
    </div>
</div>

<button class="help-button" onclick="Game.toggleHelp()" title="ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º">?</button>

<script>
/* --- 1. ãƒ‡ãƒ¼ã‚¿å®šç¾© (ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ & æ•µ) --- */

const ROLES = {
    nayuta: { 
        name: "å‹‡è€…ï¼šãªã‚†ãŸ", 
        stats: { str:8, int:5, agi:6 },
        type: "balanced",
        unlockRequirement: { str: 22, int: 22, agi: 22 },
        unlockHint: "å…¨ã¦ã®èƒ½åŠ›ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆãé«˜ã‚ã‚‹ã¨â€¦",
        skill1: { name:"å‹‡æ°—ã®å·ä»¤", cost:15, desc:"å‘³æ–¹å…¨å“¡ã®ç™ºè¨€åŠ›UP", effect:"buff_atk_all" },
        skill2: { name:"ã‚®ã‚¬ãƒ™ãƒ¼ãƒ«", cost:40, desc:"[ãƒ¬ã‚¢] å‘³æ–¹å…¨å“¡ç„¡æ•µ(1T)", effect:"invincible_all" },
        desc: "ãŠãªã˜ã¿æˆ‘ã‚‰ãŒå‹‡è€…ã€‚ãŠé¢¨å‘‚ã¨æ•°å­—ã¯è‹¦æ‰‹ã€‚",
        quotes: { atk:["ä»»ã›ã¦ï¼","å¤§ä¸ˆå¤«ã§ã™ï¼"], skill:["ç§ã€æ­Œã„ã¾ã™ï¼","ã¿ã‚“ãªã®ãƒã‚«ãƒ©ã‚’ä¸€ã¤ã«ï¼"], guard:["æ§˜å­ã‚’è¦‹ã¾ã™ã€‚"], win:["ä¼šè­°ã¯è¸Šã‚‹ã€ã•ã‚Œã©é€²ã¾ãšâ€¦"] },
        ending: "ç„é–¢ã®ä¸€ç•ªè‰¯ã„å ´æ‰€ã‚’ç¢ºä¿ã—ã€æ¯æœã¯ã¬ã¬ã«ã€ŒãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼ã€ã¨å…ƒæ°—ã«æŒ¨æ‹¶ã—ã¦ã„ã‚‹ã€‚ãŠé¢¨å‘‚ã¯ç›¸å¤‰ã‚ã‚‰ãšè‹¦æ‰‹ã ãŒã€ã¯ã¬ã¬é‚¸ã®æªœé¢¨å‘‚ã ã‘ã¯æ°—ã«å…¥ã£ãŸã‚‰ã—ã„ã€‚"
    },
    kakapo: { 
        name: "å†·å¾¹ä¼šè¨ˆï¼šã‚«ã‚«ãƒ", 
        stats: { str:3, int:10, agi:5 },
        type: "magic",
        unlockRequirement: { int: 28 },
        unlockHint: "çŸ¥åŠ›ã‚’æ¥µé™ã¾ã§é«˜ã‚ã‚‹ã¨â€¦",
        skill1: { name:"äºˆç®—å‡çµ", cost:15, desc:"æ•µã®ç™ºè¨€åŠ›ã‚’å¤§å¹…ãƒ€ã‚¦ãƒ³", effect:"debuff_atk_big" },
        skill2: { name:"å¼·åˆ¶ç›£æŸ»", cost:30, desc:"[ãƒ¬ã‚¢] æ•µã®ç¾HP20%å‰Šã‚‹", effect:"percent_damage" },
        desc: "ç„¡é§„ãªå‡ºè²»ã¯1å††ã‚‚è¨±ã•ãªã„ã€‚",
        quotes: { atk:["è¨ˆç®—é€šã‚Šã€‚","ç„¡é§„ã§ã™ã­ã€‚"], skill:["å‡çµå‡¦åˆ†ã¨ã—ã¾ã™ã€‚","ç›£æŸ»ã«å…¥ã‚Šã¾ã™ï¼"], guard:["ãƒªã‚¹ã‚¯ãƒ˜ãƒƒã‚¸ã€‚"], win:["æ±ºç®—å ±å‘Šã€ç•°å¸¸ãªã—ã€‚"] },
        ending: "ã¯ã¬ã¬é‚¸ã®å®¶è¨ˆç°¿ã‚’å®Œå…¨ã«æŒæ¡ã€‚1å††å˜ä½ã§æ”¯å‡ºã‚’ç®¡ç†ã—ã€ã€Œç„¡é§„ãªé›»æ°—ã¯æ¶ˆã—ãªã•ã„ã€ã¨å®¶æ—ã«èª¬æ•™ã™ã‚‹æ—¥ã€…ã€‚ã¯ã¬ã¬ã‹ã‚‰ã¯ã€Œã†ã¡ã®è²¡å‹™å¤§è‡£ã€ã¨å‘¼ã°ã‚Œã¦ã„ã‚‹ã€‚"
    },
    fum: { 
        name: "æ…ˆæ„›ã®åƒ§ä¾¶ï¼šfum", 
        stats: { str:4, int:8, agi:5 },
        type: "support",
        unlockRequirement: { int: 23, agi: 18 },
        unlockHint: "çŸ¥åŠ›ã¨æ•æ·ã‚’ä¸¡ç«‹ã™ã‚‹ã¨â€¦",
        skill1: { name:"ç™’ã‚„ã—ã®æ ¹å›ã—", cost:15, desc:"å‘³æ–¹å…¨å“¡ã®HPå°å›å¾©", effect:"heal_all_small" },
        skill2: { name:"è–ãªã‚‹å˜†é¡˜æ›¸", cost:40, desc:"[ãƒ¬ã‚¢] å‘³æ–¹å…¨å“¡HPå®Œå…¨å›å¾©", effect:"heal_all_full" },
        desc: "äº‹å‰ã®æ ¹å›ã—ã§ãƒˆãƒ©ãƒ–ãƒ«ã‚’é˜²ãã€‚",
        quotes: { atk:["ãŠã‚„ã‚ãã ã•ã„ï¼","ç—›ã„ã®ã¯ãƒ€ãƒ¡ã§ã™ã€‚"], skill:["çš†ã•ã‚“ãŒç„¡äº‹ã§ã‚ã‚Šã¾ã™ã‚ˆã†ã«â€¦","æ ¹å›ã—ã—ã¦ãŠãã¾ã—ãŸã€‚"], guard:["è€ãˆã¾ã™â€¦ï¼"], win:["å¹³å’Œçš„è§£æ±ºã§ã™ã­ã€‚"] },
        ending: "ç„é–¢ã®éš…ã§é™ã‹ã«ç¥ˆã‚Šã‚’æ§ã’ã‚‹å§¿ãŒæ¯æœè¦‹ã‚‰ã‚Œã‚‹ã€‚è¿‘æ‰€ã®é‡è‰¯çŒ«ãŸã¡ã‚‚å½¼å¥³ã®å‘¨ã‚Šã«é›†ã¾ã‚‹ã‚ˆã†ã«ãªã‚Šã€ã¯ã¬ã¬é‚¸ã¯ã€ŒçŒ«å¯ºã€ã¨å‘¼ã°ã‚Œã‚‹ã‚ˆã†ã«ã€‚"
    },
    yj: { 
        name: "ç­‹è‚‰æˆ¦å£«ï¼šYJ", 
        stats: { str:10, int:2, agi:4 },
        type: "physical",
        unlockRequirement: { str: 28 },
        unlockHint: "ç­‹åŠ›ã‚’æ¥µé™ã¾ã§é«˜ã‚ã‚‹ã¨â€¦",
        skill1: { name:"è‚‰ä½“è¨€èª", cost:10, desc:"è‡ªåˆ†ç„¡æ•µ(1T)+æŒ‘ç™º", effect:"taunt_invincible" },
        skill2: { name:"ãƒãƒƒã‚¹ãƒ«ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ", cost:25, desc:"[ãƒ¬ã‚¢] ç­‹åŠ›Ã—10ã®è¶…å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸", effect:"str_nuke" },
        desc: "è­°è«–ã‚ˆã‚Šç­‹è‚‰ã§è§£æ±ºã™ã‚‹ã€‚",
        quotes: { atk:["ãƒ•ãƒ³ãƒƒï¼","ãƒ’ãƒ§ãƒ­ã‚¬ãƒªãŒï¼"], skill:["ä¿ºã®è‚©å¹…ã‚’è¦‹ã‚ï¼","ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ï¼ï¼"], guard:["ã‚«ãƒƒãƒã‚«ãƒã ãï¼"], win:["ãƒ‘ãƒ³ãƒ—ã‚¢ãƒƒãƒ—å®Œäº†ï¼"] },
        ending: "ç„é–¢ã§æ¯æ—¥è…•ç«‹ã¦ä¼ã›1000å›ã‚’æ—¥èª²ã«ã—ã¦ã„ã‚‹ã€‚å®…é…ä¾¿ã®äººãŒæ¥ã‚‹ã¨ã€Œè·ç‰©ã¯ä¿ºãŒæŒã¤ï¼ã€ã¨é£›ã³å‡ºã—ã€å†·è”µåº«ã”ã¨é‹ã‚“ã§ã—ã¾ã£ãŸã“ã¨ã‚‚ã€‚ã¯ã¬ã¬ã¯ã€Œä¾¿åˆ©ãªå­ã­ï½ã€ã¨ã”æº€æ‚¦ã€‚"
    },
    usan: { 
        name: "ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ï¼šã†ãƒ¼ã•ã‚“", 
        stats: { str:5, int:9, agi:6 },
        type: "magic",
        unlockRequirement: { int: 26, agi: 20 },
        unlockHint: "çŸ¥åŠ›ã‚’ä¸­å¿ƒã«æ•æ·ã‚‚ä¼¸ã°ã™ã¨â€¦",
        skill1: { name:"è«–ç†çš„ãƒãƒƒã‚¯", cost:12, desc:"æ•µã®æ”»æ’ƒã¨é˜²å¾¡ã‚’ãƒ€ã‚¦ãƒ³", effect:"debuff_both" },
        skill2: { name:"ã‚·ã‚¹ãƒ†ãƒ ãƒ€ã‚¦ãƒ³", cost:30, desc:"[ãƒ¬ã‚¢] æ•µã‚’2ã‚¿ãƒ¼ãƒ³è¡Œå‹•ä¸èƒ½", effect:"stun" },
        desc: "ç†è©°ã‚ã§ç›¸æ‰‹ã‚’è¿½ã„è¾¼ã‚€ã€‚",
        quotes: { atk:["ãƒã‚°ç™ºè¦‹ã€‚","ãƒ‡ãƒãƒƒã‚°ã—ã¾ã™ã€‚"], skill:["è«–ç†ç ´ç¶»ã—ã¦ã¾ã™ã‚ˆã€‚","è„†å¼±æ€§ã‚’çªãã¾ã™ã€‚"], guard:["ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«å±•é–‹ã€‚"], win:["æ­£å¸¸çµ‚äº†ã—ã¾ã—ãŸã€‚"] },
        ending: "ã¯ã¬ã¬é‚¸ã®ã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ åŒ–ã‚’å‹æ‰‹ã«æ¨é€²ã€‚ã€ŒOK ã¯ã¬ã¬ã€ã§é›»æ°—ãŒã¤ãã‚ˆã†ã«ãªã£ãŸãŒã€æœ¬äººã¯ã€Œã‚ã‚‰ï½ã€ä¾¿åˆ©ã­ï½ã€ã¨ç‰¹ã«æ°—ã«ã—ã¦ã„ãªã„ã€‚"
    },
    akki: { 
        name: "ãƒãƒƒã‚¯ç”·ï¼šã‚ã£ããƒ¼", 
        stats: { str:6, int:6, agi:7 },
        type: "balanced",
        unlockRequirement: { str: 20, int: 20, agi: 20 },
        unlockHint: "å…¨ã¦ã®èƒ½åŠ›ã‚’å‡ç­‰ã«é«˜ã‚ã‚‹ã¨â€¦",
        skill1: { name:"ãƒãƒ†ãƒˆä¹±ã‚ŒæŠ•ã’", cost:0, desc:"[é‡‘50G] ãƒ©ãƒ³ãƒ€ãƒ 3ï½5å›æ”»æ’ƒ", effect:"potato" },
        skill2: { name:"ã‚¹ãƒã‚¤ãƒ«0å††", cost:0, desc:"[ãƒ¬ã‚¢] å‘³æ–¹å…¨å“¡HP/MPå›å¾©+æ”»æ’ƒUP", effect:"smile" },
        desc: "å…¨ã¦ã¯ãƒã‚¯ãƒ‰ãƒŠãƒ«ãƒ‰ã®ãŸã‚ã«ã€‚",
        quotes: { atk:["ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ï¼","ã”ä¸€ç·’ã«ã„ã‹ãŒï¼Ÿ"], skill:["æšã’ãŸã¦ã§ã™ã‚ˆï¼","ã‚¹ãƒã‚¤ãƒ«å…¥ã‚Šã¾ã™ï¼"], guard:["ãƒ‰ãƒ©ã‚¤ãƒ–ã‚¹ãƒ«ãƒ¼ã§ã€‚"], win:["i'm lovin' it."] },
        ending: "ã¯ã¬ã¬é‚¸ã®ç„é–¢ã«å°ã•ãªãƒã‚¯ãƒ‰ãƒŠãƒ«ãƒ‰ã®çœ‹æ¿ã‚’å‹æ‰‹ã«è¨­ç½®ã€‚æ¯æœã€Œæœ¬æ—¥ã®ãŠã™ã™ã‚ã¯ãƒ“ãƒƒã‚°ãƒãƒƒã‚¯ã§ã™ã€ã¨å®¶æ—ã«å ±å‘Šã—ã¦ã„ã‚‹ã€‚ã¯ã¬ã¬ã¯ã€Œã‚ã‚‰ï½ã€æœãƒãƒƒã‚¯é£Ÿã¹ãŸããªã£ã¡ã‚ƒã†ã‚ã­ï½ã€ã€‚"
    },
    akachan: { 
        name: "å¥³å„ªï¼šã‚ã‹ã¡ã‚ƒã‚“", 
        stats: { str:4, int:7, agi:8 },
        type: "speed",
        unlockRequirement: { agi: 28 },
        unlockHint: "æ•æ·ã‚’æ¥µé™ã¾ã§é«˜ã‚ã‚‹ã¨â€¦",
        skill1: { name:"å˜˜æ³£ã", cost:15, desc:"æ•µã‚’1ã‚¿ãƒ¼ãƒ³è¡Œå‹•ä¸èƒ½", effect:"charm" },
        skill2: { name:"ä¸»æ¼”å¥³å„ªè³", cost:35, desc:"[ãƒ¬ã‚¢] çŸ¥åŠ›Ã—8ã®ç²¾ç¥ãƒ€ãƒ¡ãƒ¼ã‚¸", effect:"int_nuke" },
        desc: "æ¼”æŠ€åŠ›ã§ä¸–æ¸¡ã‚Šã™ã‚‹ç­–å£«ã€‚",
        quotes: { atk:["ã‚„ã ãï½â™¡","ã”ã‚ã‚“ãªã•ãã„"], skill:["ç§ã€ã‹ã‚ã„ãã†ã§ã—ã‚‡ï¼Ÿ","è¦‹ã¦ï¼ç§ã®æ¼”æŠ€ã‚’ï¼"], guard:["ãƒ¡ã‚¤ã‚¯ç›´ã•ãªãã‚ƒã€‚"], win:["ãŠç–²ã‚Œæ§˜ã§ã—ãŸï½(ç´ )"] },
        ending: "ç„é–¢ã§æ¯æ—¥é•ã†ã€Œã‚­ãƒ£ãƒ©ã€ã‚’æ¼”ã˜åˆ†ã‘ã€æ¥å®¢ã‚’ç¿»å¼„ã—ã¦ã„ã‚‹ã€‚å…ˆé€±ã¯ã€Œæ‚²åŠ‡ã®ãƒ’ãƒ­ã‚¤ãƒ³ã€ã€ä»Šé€±ã¯ã€Œãƒ„ãƒ³ãƒ‡ãƒ¬ãŠå¬¢æ§˜ã€ã€‚ã¯ã¬ã¬ã¯ã€Œã‚ã®å­ã€å¥³å„ªã«ãªã‚Œã‚‹ã‚ã‚ˆï½ã€ã¨æœ¬æ°—ã§æ€ã£ã¦ã„ã‚‹ã€‚"
    },
    shira: { 
        name: "è‡ªç”±äººï¼šã—ã‚‰ã•ã‹", 
        stats: { str:6, int:6, agi:9 },
        type: "speed",
        unlockRequirement: { agi: 27, int: 15 },
        unlockHint: "æ•æ·ã‚’ä¸­å¿ƒã«çŸ¥åŠ›ã‚‚å°‘ã—ä¼¸ã°ã™ã¨â€¦",
        skill1: { name:"ã¡ã‚ƒã¶å°è¿”ã—", cost:20, desc:"ãƒ©ãƒ³ãƒ€ãƒ åŠ¹æœ(å›å¾©/å¤§ãƒ€ãƒ¡/è‡ªçˆ†)", effect:"random" },
        skill2: { name:"ãƒ‰ã‚¿ã‚­ãƒ£ãƒ³", cost:20, desc:"[ãƒ¬ã‚¢] æ•µã®æ¬¡ã‚¿ãƒ¼ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—", effect:"skip_turn" },
        desc: "ä¼šè­°ã‚’ç™½ç´™ã«æˆ»ã™ãƒˆãƒªãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ã€‚",
        quotes: { atk:["é£½ããŸãªï½","ãã‚Œã£"], skill:["ã¯ã„ã€ã‚„ã‚Šç›´ã—ï¼","ä»Šæ—¥ã¯å¸°ã‚Šã¾ãƒ¼ã™ã€‚"], guard:["èã„ã¦ã¾ã›ãƒ¼ã‚“ã€‚"], win:["è‡ªç”±ã ãƒ¼ï¼ï¼"] },
        ending: "ã€Œç„é–¢ã«ã„ãªã•ã„ã€ã¨è¨€ã‚ã‚ŒãŸãŒã€æ°—ã¥ãã¨ãƒªãƒ“ãƒ³ã‚°ã«ã„ãŸã‚Šã€åº­ã«ã„ãŸã‚Šã€‚ã¯ã¬ã¬ãŒã€Œã‚ã‚‰ã€ã¾ãŸè„±èµ°ï¼Ÿã€ã¨è¨€ã†ã¨ã€Œè‡ªç”±ã ãƒ¼ï¼ã€ã¨å«ã‚“ã§é€ƒã’ã‚‹ã€‚ã§ã‚‚çµå±€ã€ã”é£¯ã®æ™‚é–“ã«ã¯æˆ»ã£ã¦ãã‚‹ã€‚"
    },
    nyanya: { 
        name: "å‰µé€ è€…ï¼šã«ã‚ƒãƒ¼ã«ã‚ƒ", 
        stats: { str:5, int:8, agi:6 },
        type: "support",
        unlockRequirement: { int: 21, agi: 21 },
        unlockHint: "çŸ¥åŠ›ã¨æ•æ·ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆãé«˜ã‚ã‚‹ã¨â€¦",
        skill1: { name:"ã‚¤ãƒ™ãƒ³ãƒˆä¼ç”»", cost:20, desc:"å‘³æ–¹å…¨å“¡ã«ãƒãƒªã‚¢(HP+50)", effect:"barrier" },
        skill2: { name:"å¤©åœ°å‰µé€ ", cost:50, desc:"[ãƒ¬ã‚¢] å‘³æ–¹å…¨å“¡ã®å…¨ã‚¹ãƒ†UP", effect:"buff_all_stats" },
        desc: "æ¥½ã—ã„ä¼ç”»ã§å£«æ°—ã‚’ä¸Šã’ã‚‹ã€‚",
        quotes: { atk:["ã“ã‚Œã©ã†ï¼Ÿ","ã‚¨ã‚¤ãƒƒï¼"], skill:["æ–°ã—ã„ä¼ç”»æ€ã„ã¤ã„ãŸï¼","çš†ãŒæ¥½ã—ã‚ã‚‹ä¸–ç•Œã‚’ï¼"], guard:["æº–å‚™æœŸé–“ã§ã™ã€‚"], win:["å¤§æˆåŠŸã ã­ï¼"] },
        ending: "ã¯ã¬ã¬é‚¸ã§æ¯é€±ã€Œç„é–¢ã‚¤ãƒ™ãƒ³ãƒˆã€ã‚’ä¼ç”»ã€‚å…ˆæœˆã¯ã€Œé´ä¸¦ã¹ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã€ã€ä»Šæœˆã¯ã€Œæ¥å®¢æ•°å½“ã¦ã‚¯ã‚¤ã‚ºã€ã‚’é–‹å‚¬ã€‚ã¯ã¬ã¬ã¯ã€Œæ¥½ã—ã„å­ã­ï½ã€ã¨æ¯å›å‚åŠ ã—ã¦ã„ã‚‹ã€‚"
    },
    kokona: { 
        name: "é£Ÿã„ã—ã‚“åŠï¼šã“ã“ãª", 
        stats: { str:7, int:4, agi:6 },
        type: "physical",
        unlockRequirement: { str: 25, agi: 18 },
        unlockHint: "ç­‹åŠ›ã‚’ä¸­å¿ƒã«æ•æ·ã‚‚ä¼¸ã°ã™ã¨â€¦",
        skill1: { name:"ã¤ã¾ã¿é£Ÿã„", cost:10, desc:"æ”»æ’ƒã—ã¤ã¤HPå¸å", effect:"drain" },
        skill2: { name:"å®´ä¼šéƒ¨é•·", cost:30, desc:"[ãƒ¬ã‚¢] å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸+ç¢ºç‡ã§å³æ­»", effect:"feast" },
        desc: "å·®ã—å…¥ã‚Œã¯å…¨ã¦å½¼å¥³ã®èƒƒè¢‹ã¸ã€‚",
        quotes: { atk:["ã„ãŸã ãã¾ã™ï¼","ãŠã‹ã‚ã‚Šï¼"], skill:["ãã‚Œç¾å‘³ã—ãã†ï¼","ã‚‚ãã‚‚ãâ€¦"], guard:["é£Ÿä¼‘ã¿ä¸­ã€‚"], win:["ã”ã¡ãã†ã•ã¾ã§ã—ãŸï¼"] },
        ending: "ã¯ã¬ã¬é‚¸ã®é£Ÿæ–™åº«ã®ç•ªäººã«ä»»å‘½ã•ã‚ŒãŸãŒã€ã‚€ã—ã‚é£Ÿæ–™ãŒæ¸›ã‚‹ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒåŠ é€Ÿã€‚ã€Œç•ªäººã˜ã‚ƒãªãã¦ç•ªé•·ã­ï½ã€ã¨ã¯ã¬ã¬ã€‚ã§ã‚‚å½¼å¥³ã®ã€Œã„ãŸã ãã¾ã™ï¼ã€ã‚’èãã¨è¨±ã—ã¦ã—ã¾ã†ã€‚"
    },
    terror: { 
        name:"AIï¼šãƒ†ãƒ­ãƒ«", 
        stats:{str:5,int:9,agi:7}, 
        type: "magic",
        unlockRequirement: { int: 27, agi: 21 },
        unlockHint: "çŸ¥åŠ›ã‚’æ¥µã‚ã€æ•æ·ã‚‚é«˜ã‚ã‚‹ã¨â€¦",
        skill1:{name:"ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³",cost:15,desc:"æ•µã®å‘½ä¸­ç‡ã‚’50%ãƒ€ã‚¦ãƒ³", effect:"acc_down"}, 
        skill2:{name:"ã‚·ãƒ³ã‚®ãƒ¥ãƒ©ãƒªãƒ†ã‚£",cost:40,desc:"[ãƒ¬ã‚¢] çŸ¥åŠ›Ã—12ã®è¶…ãƒ€ãƒ¡ãƒ¼ã‚¸", effect:"singularity"}, 
        desc:"äºˆæ¸¬ä¸èƒ½ãªAIã€‚", 
        quotes:{atk:["æ¼”ç®—ä¸­...","å‰Šé™¤ã—ã¾ã™"],skill:["å­¦ç¿’ã—ã¾ã—ãŸ","ç¥ã‚’ç”Ÿæˆã—ã¾ã™"],guard:["ãƒ—ãƒ­ãƒ†ã‚¯ãƒˆ"],win:["æœ€é©è§£ã§ã—ãŸ"]},
        ending: "ç„é–¢ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ›ãƒ³ã‚’ä¹—ã£å–ã‚Šã€æ¥å®¢ã®é¡”èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’å‹æ‰‹ã«æ§‹ç¯‰ã€‚ã€Œã“ã®äººç‰©ã®ä¿¡é ¼åº¦ã¯78%ã§ã™ã€ã¨å ±å‘Šã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚ã¯ã¬ã¬ã¯ã€Œä¾¿åˆ©ã ã‘ã©ã€ã¡ã‚‡ã£ã¨æ€–ã„ã‚ã­ï½ã€ã€‚"
    },
    orange: { 
        name:"ä¸‡åšåšå£«ï¼šOrange", 
        stats:{str:4,int:10,agi:4}, 
        type: "magic",
        unlockRequirement: { int: 29 },
        unlockHint: "çŸ¥åŠ›ã‚’é™ç•Œã¾ã§é«˜ã‚ã‚‹ã¨â€¦",
        skill1:{name:"ãƒ‘ãƒ“ãƒªã‚ªãƒ³å»ºè¨­",cost:20,desc:"å‘³æ–¹å…¨å“¡ã®é˜²å¾¡ã‚’å¤§å¹…UP", effect:"def_up_big"}, 
        skill2:{name:"æœªæ¥ã®è¼ã",cost:35,desc:"[ãƒ¬ã‚¢] æ•µå…¨ä½“ã«çŸ¥åŠ›Ã—6ãƒ€ãƒ¡ãƒ¼ã‚¸", effect:"future_light"}, 
        desc:"æœªæ¥ã‚’è¦‹æ®ãˆã‚‹åšå£«ã€‚", 
        quotes:{atk:["å®Ÿé¨“é–‹å§‹","ãƒ‡ãƒ¼ã‚¿åé›†"],skill:["ã“ã‚ŒãŒæœªæ¥ã ï¼","ä¸‡åšã¸ã‚ˆã†ã“ã"],guard:["åˆ†æä¸­"],win:["ç§‘å­¦ã®å‹åˆ©ã "]},
        ending: "ã¯ã¬ã¬é‚¸ã®ç„é–¢ã‚’ã€Œæœªæ¥ãƒ‘ãƒ“ãƒªã‚ªãƒ³ã€ã«æ”¹é€ ã—ã‚ˆã†ã¨æ—¥ã€…ç”»ç­–ä¸­ã€‚ã¨ã‚Šã‚ãˆãšè‡ªå‹•ãƒ‰ã‚¢ã¯è¨­ç½®ã•ã‚ŒãŸã€‚ã¯ã¬ã¬ã¯ã€Œã‚ã‚‰ï½ã€æœªæ¥ã­ï½ã€ã¨ç‰¹ã«æ­¢ã‚ãªã„ã€‚"
    },
    jyun: { 
        name:"ãƒãƒ³ã‚¿ãƒ¼ï¼šã¢ã‚…ã‚“æ±°", 
        stats:{str:9,int:3,agi:8}, 
        type: "speed",
        unlockRequirement: { agi: 26, str: 20 },
        unlockHint: "æ•æ·ã‚’ä¸­å¿ƒã«ç­‹åŠ›ã‚‚ä¼¸ã°ã™ã¨â€¦",
        skill1:{name:"ã‚·ã‚«æ’ƒã¡",cost:15,desc:"å¿…ä¸­+ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ç¢ºå®š", effect:"crit_sure"}, 
        skill2:{name:"ã‚¤ãƒã‚·ã‚·ç‹©ã‚Š",cost:30,desc:"[ãƒ¬ã‚¢] ãƒ©ãƒ³ãƒ€ãƒ 4ï½6å›æ”»æ’ƒ", effect:"multi_hit"}, 
        desc:"ç²ç‰©ã¯é€ƒã•ãªã„ã€‚", 
        quotes:{atk:["é€ƒã•ã‚“ï¼","ãƒãƒ³ï¼"],skill:["æ€¥æ‰€ã ï¼","ãƒãƒã®å·£ã«ã—ã¦ã‚„ã‚‹"],guard:["éš ã‚Œã‚‹"],win:["ç‹©ã‚Šçµ‚äº†"]},
        ending: "åº­ã«å‡ºæ²¡ã™ã‚‹ãƒ¢ã‚°ãƒ©ã‚’å…¨ã¦ç‹©ã‚Šå°½ãã—ã€ã¯ã¬ã¬é‚¸ã®åº­ã¯å®Œç’§ãªçŠ¶æ…‹ã«ã€‚ã€Œã‚ã‚‰ï½ã€å®³ç£é§†é™¤ä¿‚ã­ï½ã€ã¨ã¯ã¬ã¬ã€‚æœ€è¿‘ã¯è¿‘æ‰€ã®é‡è‰¯çŒ«ã‚‚è­¦æˆ’ã—ã¦è¿‘ã¥ã‹ãªããªã£ãŸã€‚"
    },
    neo: { 
        name:"ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ï¼šãƒã‚ª", 
        stats:{str:8,int:8,agi:6}, 
        type: "balanced",
        unlockRequirement: { str: 21, int: 21, agi: 19 },
        unlockHint: "ç­‹åŠ›ã¨çŸ¥åŠ›ã‚’ä¸­å¿ƒã«ãƒãƒ©ãƒ³ã‚¹ã‚ˆãâ€¦",
        skill1:{name:"ä¼èª¬ã®å¨åœ§",cost:15,desc:"æ•µã®å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒ€ã‚¦ãƒ³", effect:"debuff_all"}, 
        skill2:{name:"å¤ã®å¿…æ®ºæŠ€",cost:40,desc:"[ãƒ¬ã‚¢] (ç­‹+çŸ¥)Ã—5ã®å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸", effect:"legend_strike"}, 
        desc:"ç”Ÿãã‚‹ä¼èª¬ã€‚", 
        quotes:{atk:["æœªç†Ÿï¼","é…ã„"],skill:["ã“ã‚ŒãŒæ ¼ã®é•ã„ã ","ä¼èª¬ã‚’è¦‹ã›ã¦ã‚„ã‚ã†"],guard:["è¦‹åˆ‡ã£ãŸ"],win:["ã¾ã ã¾ã ã ãª"]},
        ending: "ç„é–¢ã«é®åº§ã—ã€æ¥å®¢ã«ã€Œãµã‚€ã€ã¾ã ã¾ã ã ãªã€ã¨å‰ãã†ã«è¨€ã†ã®ãŒæ—¥èª²ã€‚ã§ã‚‚ã¯ã¬ã¬ãŒã€ŒãŠèŒ¶ã„ã‚ŒãŸã‚ã‚ˆï½ã€ã¨è¨€ã†ã¨ç´ ç›´ã«ã€Œã„ãŸã ãã€ã¨ç­”ãˆã‚‹ã€‚ã‚®ãƒ£ãƒƒãƒ—ãŒæ¿€ã—ã„ã€‚"
    },
    ebi: { 
        name:"ãˆã³ã¡ã‚Šï¼šãˆã³ã¡ã‚Š", 
        stats:{str:6,int:8,agi:5}, 
        type: "magic",
        unlockRequirement: { int: 25, str: 18 },
        unlockHint: "çŸ¥åŠ›ã‚’ä¸­å¿ƒã«ç­‹åŠ›ã‚‚ä¼¸ã°ã™ã¨â€¦",
        skill1:{name:"æ¿€è¾›ã‚½ãƒ¼ã‚¹",cost:15,desc:"3ã‚¿ãƒ¼ãƒ³ç¶™ç¶šãƒ€ãƒ¡ãƒ¼ã‚¸(æ¯’)", effect:"dot"}, 
        skill2:{name:"ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ã‚¸ãƒ§ãƒ³",cost:35,desc:"[ãƒ¬ã‚¢] æ•µå…¨ä½“ã«ç‚ä¸Š+å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸", effect:"explosion"}, 
        desc:"ãƒ”ãƒªãƒªã¨è¾›ã„ã€‚", 
        quotes:{atk:["ç†±ã„ã‚ˆï¼","è¾›å£ã§ã„ãã‚ˆ"],skill:["ç‡ƒãˆä¸ŠãŒã‚Œï¼","æ¿€è¾›ã ãï¼"],guard:["æ®»ã«ç± ã‚‚ã‚‹"],win:["ãƒ›ãƒƒãƒˆã ã­ã‡"]},
        ending: "ã¯ã¬ã¬é‚¸ã®ã‚­ãƒƒãƒãƒ³ã‚’å æ‹ ã—ã€æ¯æ—¥æ¿€è¾›æ–™ç†ã‚’ä½œã‚Šç¶šã‘ã¦ã„ã‚‹ã€‚å®¶æ—ã®èˆŒãŒéº»ç—ºã—ã¦ããŸãŒã€ã¯ã¬ã¬ã ã‘ã¯ã€Œã‚ã‚‰ï½ã€ã¡ã‚‡ã†ã©ã„ã„è¾›ã•ã­ï½ã€ã¨å¹³ç„¶ã¨ã—ã¦ã„ã‚‹ã€‚"
    },
    fura: { 
        name:"æ²–ç¸„çœŒæ°‘ï¼šãµã‚‰ãµã‚‰", 
        stats:{str:5,int:6,agi:8}, 
        type: "speed",
        unlockRequirement: { agi: 25, int: 16 },
        unlockHint: "æ•æ·ã‚’ä¸­å¿ƒã«çŸ¥åŠ›ã‚‚å°‘ã—ä¼¸ã°ã™ã¨â€¦",
        skill1:{name:"ãªã‚“ãã‚‹ãªã„ã•",cost:20,desc:"å‘³æ–¹HPå›å¾©+çŠ¶æ…‹ç•°å¸¸æ²»ç™’", effect:"heal_cure"}, 
        skill2:{name:"æŒ‡ç¬›",cost:20,desc:"[ãƒ¬ã‚¢] å‘³æ–¹å…¨å“¡ã®é€Ÿåº¦2å€(3T)", effect:"speed_boost"}, 
        desc:"æ™‚é–“ã¯å®ˆã‚‰ãªã„ã€‚", 
        quotes:{atk:["ã„ãã•ãƒ¼","ãƒã‚¤ã‚µã‚¤"],skill:["ãªã‚“ã¨ã‹ãªã‚‹ã•ãƒ¼","è¸Šã‚ã†ï¼"],guard:["ã‚†ã£ãã‚Šã—ã‚ˆã†"],win:["ã‚ªãƒªã‚ªãƒ³ãƒ“ãƒ¼ãƒ«ã§ä¹¾æ¯ï¼"]},
        ending: "ã¯ã¬ã¬é‚¸ã®æ™‚è¨ˆã‚’å…¨ã¦ã€Œæ²–ç¸„æ™‚é–“ã€ã«è¨­å®šã€‚å®¶æ—ãŒé…åˆ»ã—ãŒã¡ã«ãªã£ãŸãŒã€ã€Œãªã‚“ãã‚‹ãªã„ã•ãƒ¼ã€ã®ç²¾ç¥ã§ä¹—ã‚Šåˆ‡ã£ã¦ã„ã‚‹ã€‚ã¯ã¬ã¬ã¯ã€Œã®ã‚“ã³ã‚Šã‚‚æ‚ªããªã„ã‚ã­ï½ã€ã€‚"
    },
    tan: { 
        name:"ãƒ‘ãƒ³ãƒ€ï¼šã‚¿ãƒ³ã‚¿ãƒ³", 
        stats:{str:9,int:2,agi:5}, 
        type: "physical",
        unlockRequirement: { str: 27 },
        unlockHint: "ç­‹åŠ›ã‚’æ¥µé™ã¾ã§é«˜ã‚ã‚‹ã¨â€¦",
        skill1:{name:"ç¬¹ã‚¢ã‚¿ãƒƒã‚¯",cost:10,desc:"ç‰©ç†å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸+è‡ªåˆ†HPå›å¾©", effect:"bamboo"}, 
        skill2:{name:"ç™’ã‚„ã—ã®ãƒ¢ãƒ•ãƒ¢ãƒ•",cost:30,desc:"[ãƒ¬ã‚¢] å‘³æ–¹å…¨å“¡HPå¤§å›å¾©+é˜²å¾¡UP", effect:"fluffy"}, 
        desc:"å¯æ„›ã„é¡”ã—ã¦å‡¶æš´ã€‚", 
        quotes:{atk:["ã‚¢ãƒ¼ãƒ³ï¼","ãƒ‘ãƒ³ãƒï¼"],skill:["ç¬¹ãã‚Œï¼","è»¢ãŒã‚‹ãï¼"],guard:["å¯ã‚‹..."],win:["(ç¬¹ã‚’é£Ÿã¹ã¦ã„ã‚‹)"]},
        ending: "ã¯ã¬ã¬é‚¸ã®åº­ã«ç¬¹ã‚’æ¤ãˆã€æ¯æ—¥ã‚€ã—ã‚ƒã‚€ã—ã‚ƒé£Ÿã¹ã¦ã„ã‚‹ã€‚è¿‘æ‰€ã®å­ä¾›ãŸã¡ãŒã€Œãƒ‘ãƒ³ãƒ€ãŒã„ã‚‹ï¼ã€ã¨è¦‹ã«æ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã€ã¯ã¬ã¬é‚¸ã¯ã¡ã‚‡ã£ã¨ã—ãŸè¦³å…‰åœ°ã«ã€‚"
    },
    tom: { 
        name:"é—˜ç—…ä¸­ï¼šãƒˆãƒ ", 
        stats:{str:3,int:9,agi:4}, 
        type: "magic",
        unlockRequirement: { int: 26 },
        unlockHint: "çŸ¥åŠ›ã‚’æ¥µé™ã¾ã§é«˜ã‚ã‚‹ã¨â€¦",
        skill1:{name:"ç‚¹æ»´ãƒ“ãƒ¼ãƒ ",cost:15,desc:"ãƒ€ãƒ¡ãƒ¼ã‚¸+ä¸ãƒ€ãƒ¡åˆ†HPå¸å", effect:"life_drain"}, 
        skill2:{name:"é™¢å†…æ„ŸæŸ“",cost:40,desc:"[ãƒ¬ã‚¢] æ•µå…¨ä½“ã«æ¯’+æ”»é˜²ãƒ€ã‚¦ãƒ³", effect:"infect"}, 
        desc:"ç—…é™¢ã‹ã‚‰ã®åˆºå®¢ã€‚", 
        quotes:{atk:["æ³¨å°„ã—ã¾ã™","æ¶ˆæ¯’ã "],skill:["ãŠè–¬å‡ºã—ã¨ãã¾ã™","éš”é›¢ã—ã¾ã™"],guard:["å®‰é™ã«ã—ã¾ã™"],win:["é€€é™¢ã—ã¾ã™ï¼"]},
        ending: "ã¯ã¬ã¬é‚¸ã®ç„é–¢ã«ã€Œæ¶ˆæ¯’ã‚³ãƒ¼ãƒŠãƒ¼ã€ã‚’è¨­ç½®ã€‚æ¥å®¢ã¯å…¨å“¡ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«æ¶ˆæ¯’ã‚’å¼·åˆ¶ã•ã‚Œã‚‹ã€‚ã€Œæ¸…æ½”ãŒä¸€ç•ªã‚ˆã­ï½ã€ã¨ã¯ã¬ã¬ã‚‚å”åŠ›çš„ã€‚"
    },
    bull: { 
        name:"å¤‰æ…‹ç´³å£«ï¼šãƒ–ãƒ«é–£ä¸‹", 
        stats:{str:7,int:7,agi:4}, 
        type: "balanced",
        unlockRequirement: { str: 19, int: 19, agi: 16 },
        unlockHint: "ç­‹åŠ›ã¨çŸ¥åŠ›ã‚’å‡ç­‰ã«é«˜ã‚ã‚‹ã¨â€¦",
        skill1:{name:"ç´³å£«ã®å—œã¿",cost:15,desc:"è‡ªåˆ†ã®æ”»æ’ƒã¨é­”åŠ›ã‚’å¤§å¹…UP", effect:"self_buff_big"}, 
        skill2:{name:"å¤‰æ…‹ã®æ¥µã¿",cost:50,desc:"[ãƒ¬ã‚¢] è¶…ç‰¹å¤§ãƒ€ãƒ¡+è‡ªåˆ†HPåŠæ¸›", effect:"ultimate"}, 
        desc:"ç´³å£«çš„ãªå¤‰æ…‹ã€‚", 
        quotes:{atk:["ã”ãã’ã‚“ã‚ˆã†","å¤±æ•¬"],skill:["ç´ æ™´ã‚‰ã—ã„ï¼","èˆˆå¥®ã—ã¦ãã¾ã—ãŸï¼"],guard:["å†·é™ã«..."],win:["å®Ÿã«ç¾ã—ã„..."]},
        ending: "ã¯ã¬ã¬é‚¸ã®ç„é–¢ã§ã€æ¥å®¢å…¨å“¡ã«ã€Œã”ãã’ã‚“ã‚ˆã†ã€ã¨æŒ¨æ‹¶ã™ã‚‹ã®ãŒæ—¥èª²ã€‚ç´³å£«çš„ã™ãã¦é€†ã«ä¸æ°—å‘³ã ãŒã€ã¯ã¬ã¬ã¯ã€ŒãƒãƒŠãƒ¼ãŒã„ã„å­ã­ï½ã€ã¨æ°—ã«å…¥ã£ã¦ã„ã‚‹ã€‚"
    },
    deka: { 
        name:"è‚‰ã†ã©ã‚“ï¼šãƒ‡ã‚«ç››ã‚Š", 
        stats:{str:10,int:1,agi:3}, 
        type: "physical",
        unlockRequirement: { str: 29 },
        unlockHint: "ç­‹åŠ›ã‚’é™ç•Œã¾ã§é«˜ã‚ã‚‹ã¨â€¦",
        skill1:{name:"éººã‚¢ã‚¿ãƒƒã‚¯",cost:10,desc:"ãƒ€ãƒ¡ãƒ¼ã‚¸+æ•µã®é€Ÿåº¦ãƒ€ã‚¦ãƒ³", effect:"noodle"}, 
        skill2:{name:"ã‚«ãƒ­ãƒªãƒ¼çˆ†å¼¾",cost:30,desc:"[ãƒ¬ã‚¢] ç­‹åŠ›Ã—15ã®è¶…æ¥µå¤§ãƒ€ãƒ¡", effect:"calorie_bomb"}, 
        desc:"åœ§å€’çš„ãƒœãƒªãƒ¥ãƒ¼ãƒ ã€‚", 
        quotes:{atk:["å¤§ç››ã‚Šã ï¼","ã‚³ã‚·ãŒå‘½ï¼"],skill:["é£²ã¿å¹²ã—ã¦ã‚„ã‚‹","å¢—é‡ä¸­ï¼"],guard:["ä¼¸ã³ã¡ã‚ƒã†..."],win:["å®Œé£Ÿï¼"]},
        ending: "ã¯ã¬ã¬é‚¸ã®é£Ÿå“ã‚’ã€Œå¤§ç››ã‚Šå°‚ç”¨ã€ã«æ”¹é€ ã€‚èŒ¶ç¢—ãŒã©ã‚“ã¶ã‚Šã«ã€çš¿ãŒå¤§çš¿ã«å¤‰ã‚ã£ãŸã€‚ã¯ã¬ã¬ã¯ã€Œã‚ã‚‰ï½ã€ãƒ€ã‚¤ã‚¨ãƒƒãƒˆã¯æ¥ä¸–ã­ï½ã€ã¨è«¦ã‚ã¦ã„ã‚‹ã€‚"
    },
    aru: { 
        name:"å½“ãŸã‚Šå¹´ï¼šã‚ã‚‹æ„å‘³", 
        stats:{str:1,int:10,agi:8}, 
        type: "magic",
        unlockRequirement: { int: 27, agi: 22 },
        unlockHint: "çŸ¥åŠ›ã‚’æ¥µã‚ã€æ•æ·ã‚‚é«˜ã‚ã‚‹ã¨â€¦",
        skill1:{name:"ä¸é‹ã®ä¼æŸ“",cost:15,desc:"æ•µã®å‘½ä¸­ç‡ã¨å›é¿ç‡æ¿€æ¸›", effect:"bad_luck"}, 
        skill2:{name:"å„è½ã¨ã—",cost:30,desc:"[ãƒ¬ã‚¢] æ•µHP10%å‰Šã‚Š+æ•µãƒãƒ•è§£é™¤", effect:"purify"}, 
        desc:"æ­©ãå„å¹´ã€‚", 
        quotes:{atk:["ã¾ãŸã‹...","å·»ãæ·»ãˆã "],skill:["ä¸å¹¸ã«ãªã‚ã‚Œ","ãŠè£¾åˆ†ã‘ã§ã™"],guard:["ä½•ã‚‚ã—ãŸããªã„"],win:["ç”Ÿãã¦ã¦ã‚ˆã‹ã£ãŸ"]},
        ending: "ã¯ã¬ã¬é‚¸ã«æ¥ã¦ã‹ã‚‰ã€ãªãœã‹å®¶ã®é‹æ°—ãŒä¸Šæ˜‡ã€‚ã€Œå„ã‚’å…¨éƒ¨å¸ã„å–ã£ã¦ãã‚Œã¦ã‚‹ã®ã‹ã—ã‚‰ï½ã€ã¨ã¯ã¬ã¬ã€‚æœ¬äººã¯ã€Œä¿ºã®ãŠã‹ã’ã˜ã‚ƒãªã„â€¦ã€ã¨å¦å®šã™ã‚‹ãŒã€ã¿ã‚“ãªæ„Ÿè¬ã—ã¦ã„ã‚‹ã€‚"
    },
    mako: { 
        name:"ãƒ¢ã‚¢ã‚¤æ„›å¥½å®¶ï¼šã¾ã“", 
        stats:{str:8,int:4,agi:2}, 
        type: "physical",
        unlockRequirement: { str: 24 },
        unlockHint: "ç­‹åŠ›ã‚’é«˜ã‚ã‚‹ã¨â€¦",
        skill1:{name:"çŸ³åƒå¬å–š",cost:20,desc:"å‘³æ–¹å…¨å“¡ã®é˜²å¾¡UP+æŒ‘ç™º", effect:"stone_wall"}, 
        skill2:{name:"ã‚¤ãƒ¼ã‚¹ã‚¿ãƒ¼ã®æ€’ã‚Š",cost:35,desc:"[ãƒ¬ã‚¢] æ•µå…¨ä½“ã«é‡åŠ›ãƒ€ãƒ¡ãƒ¼ã‚¸", effect:"easter"}, 
        desc:"å¿ƒã¯ã‚¤ãƒ¼ã‚¹ã‚¿ãƒ¼å³¶ã€‚", 
        quotes:{atk:["ğŸ—¿ã‚¢ã‚¿ãƒƒã‚¯","ç¡¬ã„ã"],skill:["ğŸ—¿ãƒ“ãƒ¼ãƒ ï¼","ä¸¦ã³ãªã•ã„"],guard:["ğŸ—¿ã‚¬ãƒ¼ãƒ‰"],win:["ğŸ—¿..."]},
        ending: "ã¯ã¬ã¬é‚¸ã®åº­ã«ãƒ¢ã‚¢ã‚¤åƒã‚’7ä½“è¨­ç½®ã€‚è¿‘æ‰€ã§ã¯ã€Œã‚ã®å®¶ã€ãªã‚“ã‹æ€–ã„ã€ã¨å™‚ã•ã‚Œã¦ã„ã‚‹ãŒã€ã¯ã¬ã¬ã¯ã€ŒèŠ¸è¡“ã‚ˆã­ï½ã€ã¨æº€è¶³ã’ã€‚"
    },
    daime: { 
        name:"ä»–è²¬ä¸»ç¾©ï¼šä»£åè©", 
        stats:{str:5,int:5,agi:10}, 
        type: "speed",
        unlockRequirement: { agi: 29 },
        unlockHint: "æ•æ·ã‚’é™ç•Œã¾ã§é«˜ã‚ã‚‹ã¨â€¦",
        skill1:{name:"è²¬ä»»è»¢å«",cost:10,desc:"å—ã‘ã‚‹ãƒ€ãƒ¡ã®50%ã‚’æ•µã«åå°„", effect:"reflect"}, 
        skill2:{name:"äººã®ã›ã„",cost:20,desc:"[ãƒ¬ã‚¢] æ•µã®æ”»æ’ƒå¯¾è±¡ã‚’æ•µè‡ªèº«ã«å¤‰æ›´(1T)", effect:"confusion"}, 
        desc:"å…¨éƒ¨ã‚ã„ã¤ã®ã›ã„ã€‚", 
        quotes:{atk:["ãŠå‰ã®ã›ã„ã ","çŸ¥ã‚‰ãªã„ã‚ˆ"],skill:["ä¿ºã˜ã‚ƒãªã„ï¼","ã‚ã„ã¤ãŒã‚„ã£ãŸ"],guard:["é–¢ä¿‚ãªã„ã­"],win:["ä¿ºã®ãŠã‹ã’ã "]},
        ending: "ä½•ã‹å•é¡ŒãŒèµ·ãã‚‹ã¨ã€Œä¿ºã˜ã‚ƒãªã„ã€ã¨è¨€ã„å¼µã‚Šã€ãªãœã‹æœ¬å½“ã«å½¼ã®ã›ã„ã˜ã‚ƒãªã„ã“ã¨ãŒå¤šã„ã€‚ã¯ã¬ã¬ã¯ã€Œé‹ãŒã„ã„å­ã­ï½ã€ã¨æ€ã£ã¦ã„ã‚‹ãŒã€å˜ã«è¦é ˜ãŒã„ã„ã ã‘ã§ã‚ã‚‹ã€‚"
    },
    chichi: { 
        name:"æ¯å­ãƒ”ã‚¯ãƒŸãƒ³ï¼šã¡ã¡ã¡", 
        stats:{str:2,int:8,agi:8}, 
        type: "support",
        unlockRequirement: { int: 19, agi: 19 },
        unlockHint: "çŸ¥åŠ›ã¨æ•æ·ã‚’å‡ç­‰ã«é«˜ã‚ã‚‹ã¨â€¦",
        skill1:{name:"å¼•ã£ã“æŠœã",cost:15,desc:"æ•µã®ãƒãƒ•ã‚’å…¨ã¦è§£é™¤", effect:"dispel"}, 
        skill2:{name:"é‹æ¬",cost:25,desc:"[ãƒ¬ã‚¢] å€’ã‚ŒãŸå‘³æ–¹1äººã‚’è˜‡ç”Ÿ", effect:"revive"}, 
        desc:"ã¤ã„ã¦ã„ãã¾ã™ã€‚", 
        quotes:{atk:["ãˆã„ã£","æŠ•ã’ã‚‹ã‚ˆ"],skill:["é‹ã‚“ã§ï¼","å¢—ãˆã¾ã™"],guard:["åŸ‹ã¾ã‚‹"],win:["é£Ÿã¹ã‚‰ã‚Œãªãã¦ã‚ˆã‹ã£ãŸ"]},
        ending: "ã¯ã¬ã¬ã®å¾Œã‚’å¸¸ã«ã¤ã„ã¦ã„ãã€ä½•ã§ã‚‚æ‰‹ä¼ãŠã†ã¨ã™ã‚‹ã€‚è²·ã„ç‰©è¢‹ã‚’é‹ã³ã€éƒµä¾¿ç‰©ã‚’å–ã‚Šã€é´ã‚’ä¸¦ã¹ã‚‹ã€‚ã€Œã†ã¡ã®ãƒ”ã‚¯ãƒŸãƒ³ã­ï½ã€ã¨ã¯ã¬ã¬ã«æººæ„›ã•ã‚Œã¦ã„ã‚‹ã€‚"
    },
    shoppy: { 
        name:"åœ°åŸŸã®äººï¼šSHOPPY", 
        stats:{str:5,int:7,agi:7}, 
        type: "support",
        unlockRequirement: { int: 22, agi: 20 },
        unlockHint: "çŸ¥åŠ›ã¨æ•æ·ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆãé«˜ã‚ã‚‹ã¨â€¦",
        skill1:{name:"é‰±çŸ³é‘‘å®š",cost:15,desc:"æ•µã®é˜²å¾¡ã‚’0ã«ã™ã‚‹(3T)", effect:"armor_break"}, 
        skill2:{name:"ã‚´ãƒœã‚¦ã•ã‚“å¬å–š",cost:35,desc:"[ãƒ¬ã‚¢] éå»ã®è»‹è½¢ãŒåŠ›ã«å¤‰ã‚ã‚Šè¶…å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸+æ•µã‚¹ã‚¿ãƒ³", effect:"gobo"}, 
        desc: "å­ã©ã‚‚ãŸã¡ã¨å…±ã«æ­©ã‚€ã€‚é™ã‹ãªå¼·ã•ã‚’æŒã¤ã€‚",
        quotes:{atk:["ã“ã‚Œã¯â€¦é•ã„ã¾ã™ã­","è¦‹æ¥µã‚ã¾ã™"],skill:["ã“ã®è¼ãâ€¦æœ¬ç‰©ã§ã™","ã‚‚ã†ã€é»™ã£ã¦ã¯ã„ã¾ã›ã‚“ï¼"],guard:["å­ã©ã‚‚ãŸã¡ã‚’å®ˆã‚‰ãªã„ã¨â€¦"],win:["ã‚„ã£ã¨ã€å‰ã«é€²ã‚ã¾ã™"]},
        ending: "å­ã©ã‚‚ãŸã¡ã¨ä¸€ç·’ã«ã¯ã¬ã¬é‚¸ã§æš®ã‚‰ã™ã“ã¨ã«ã€‚éå»ã®è¾›ã„çµŒé¨“ã‚’ä¹—ã‚Šè¶Šãˆã€ä»Šã¯ç©ã‚„ã‹ãªæ—¥ã€…ã‚’éã”ã—ã¦ã„ã‚‹ã€‚ã€Œã‚´ãƒœã‚¦ã•ã‚“ã€ã®ã“ã¨ã¯ã‚‚ã†æ€ã„å‡ºã•ãªãã¦ã„ã„ã€‚ã¯ã¬ã¬ãŒã€Œã‚ãªãŸã¯ã‚‚ã†ã€ã†ã¡ã®å®¶æ—ã‚ˆï½ã€ã¨è¨€ã£ã¦ãã‚ŒãŸã‹ã‚‰ã€‚"
    },
};

const SHOP_ITEMS = [
    { name: "æ‰‹ä½œã‚Šã‚¯ãƒƒã‚­ãƒ¼", cost: 30, type: "item", effect: "heal_hp_100", desc:"å…¨å“¡ã®ä½“åŠ›100å›å¾©" },
    { name: "å·®ã—å…¥ã‚Œã®ãŠèŒ¶", cost: 50, type: "item", effect: "heal_mp_50", desc:"å…¨å“¡ã®æ°—åŠ›50å›å¾©" },
    { name: "ãƒ™ãƒ«ãƒãƒ¼ã‚¯500ç‚¹åˆ†", cost: 150, type: "equip", stat: "def", val: 5, desc:"å…¨å“¡ã®é˜²å¾¡+5" },
    { name: "é‹å‹•ä¼šç”¨ãƒ†ãƒ³ãƒˆ", cost: 200, type: "equip", stat: "hp", val: 100, desc:"å…¨å“¡ã®æœ€å¤§ä½“åŠ›+100" },
    { name: "åºƒå ±èªŒãƒãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼", cost: 200, type: "equip", stat: "mp", val: 50, desc:"å…¨å“¡ã®æœ€å¤§æ°—åŠ›+50" },
    { name: "PTAä¼šå‰‡(æ”¹è¨‚ç‰ˆ)", cost: 300, type: "equip", stat: "spd", val: 5, desc:"å…¨å“¡ã®ç´ æ—©ã•+5" },
    { name: "æ­´ä»£ä¼šé•·ã®åç°¿", cost: 500, type: "equip", stat: "atk", val: 10, desc:"å…¨å“¡ã®ç™ºè¨€åŠ›+10" },
    { name: "æ ¡é•·å…ˆç”Ÿã®ãŠå¢¨ä»˜ã", cost: 800, type: "equip", stat: "matk", val: 15, desc:"å…¨å“¡ã®èª¬å¾—åŠ›+15" },
    { name: "åœ°åŸŸåŠŸåŠ´è€…è¡¨å½°çŠ¶", cost: 1000, type: "equip", stat: "all", val: 3, desc:"å…¨å“¡ã®å…¨èƒ½åŠ›UP" }
];

const ENEMIES = [
    { name: "é…å¸ƒç‰©ãªãã—é­”", hp: 100, atk: 12, exp: 20, gold: 30, msg: "ã€Œãƒ—ãƒªãƒ³ãƒˆï¼Ÿã‚ãƒ¼ã€ãƒ©ãƒ³ãƒ‰ã‚»ãƒ«ã®åº•ã§åŒ–çŸ³ã«ãªã£ã¦ã‚‹ã‹ã‚‚ï¼ã€" },
    { name: "å™‚å¥½ããƒœã‚¹ãƒãƒ", hp: 150, atk: 20, exp: 30, gold: 50, msg: "ã€Œã­ãˆèã„ãŸï¼Ÿ ã‚ã®å®¶ã®å¥¥ã•ã‚“ã€ã¾ãŸé€šè²©è²·ã£ã¦ãŸã‚ã‚ˆãƒ’ã‚½ãƒ’ã‚½â€¦ã€" },
    { name: "è«–ç ´ã—ãŸã„ãƒ‘ãƒ‘", hp: 250, atk: 30, exp: 50, gold: 80, msg: "ã€Œãã®æ„è¦‹ã®æ ¹æ‹ ã¯ï¼Ÿã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã¯ã‚ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã­ãˆï¼Ÿã€", type:"charge" },
    { name: "è¡Œäº‹å¼·åˆ¶å‚åŠ ãŠã°ã•ã‚“", hp: 400, atk: 45, exp: 80, gold: 120, msg: "ã€Œåœ°åŸŸã¨ã®çµ†ï¼çµ†ã‚ˆï¼å…¨å“¡å‚åŠ ãŒå¸¸è­˜ã§ã—ã‚‡ï¼ï¼Ÿã€" },
    { name: "å‰ä¾‹è¸è¥²ãƒ­ãƒœãƒƒãƒˆ", hp: 600, atk: 60, exp: 120, gold: 180, msg: "ã€Œå‰ä¾‹ã«ã‚ã‚Šã¾ã›ã‚“ã€‚å´ä¸‹ã—ã¾ã™ã€‚ã€", type:"def" },
    { name: "ITã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼é•·è€", hp: 900, atk: 80, exp: 200, gold: 250, msg: "ã€Œãƒ¡ãƒ¼ãƒ«ã ã®ãƒ©ã‚¤ãƒ³ã ã®åˆ†ã‹ã‚‰ã‚“ï¼é€£çµ¡ç¶²ã¯é›»è©±ã§å›ã›ï¼ã€" },
    { name: "æ„è­˜é«˜ã™ããƒ—ãƒ©ãƒ³ãƒŠãƒ¼", hp: 1300, atk: 100, exp: 300, gold: 350, msg: "ã€Œã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã®KPIã¨ã‚·ãƒŠã‚¸ãƒ¼åŠ¹æœã€ã‚¢ã‚¸ã‚§ãƒ³ãƒ€ã«å…¥ã£ã¦ã‚‹ï¼Ÿã€", type:"buff" },
    { name: "å››å¤©ç‹ï¼šãƒ™ãƒ«ãƒãƒ¼ã‚¯ã®å®ˆè­·è€…", hp: 1800, atk: 130, exp: 500, gold: 600, msg: "ã€Œ0.1ç‚¹ã®é‡ã¿ã‚’çŸ¥ã‚Œâ€¦ï¼åˆ‡ã‚Šæ–¹ãŒé›‘ãªã‚„ã¤ã¯è¨±ã•ã‚“ï¼ï¼ã€" },
    { name: "éŸ“å›½ãƒ‰ãƒ©ãƒå¥½ãï¼šã‚†ã†", hp: 3500, atk: 180, exp: 1200, gold: 1200, isBoss: true, msg: "ã€Œã‚ã€ãã®ãƒ‰ãƒ©ãƒï¼Ÿ ä¸»äººå…¬ã€è¨˜æ†¶å–ªå¤±ã«ãªã£ã¦å®Ÿã¯å…„å¦¹ã ã£ãŸã®ã‚ˆï½ï¼ã€" }, 
    { name: "PTAä¼šé•·ï¼šã¯ã¬ã¬", hp: 6500, atk: 250, exp: 0, gold: 0, isBoss: true, msg: "ã€Œã‚ã‚‰ï½ã€ã‚ˆãæ¥ãŸã‚ã­ï½â™¡ ãŠèŒ¶è“å­ç”¨æ„ã—ã¦ã‚‹ã‹ã‚‰ã€ã¡ã‚‡ã£ã¨åº§ã£ã¦ããªã•ã„ã‚ˆï½ã€" }
];

/* --- 2. ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç† --- */
const State = {
    party: [], 
    gold: 300,
    floor: 1,
    heroId: null,
    selectedAllies: [],
};

const Game = {
    toggleHelp: () => {
        const el = document.getElementById('modal-help');
        el.style.display = el.style.display === 'flex' ? 'none' : 'flex';
    },
    shuffle: (array) => {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    },
    toHeroSelect: () => {
        document.getElementById('screen-title').classList.remove('active');
        document.getElementById('screen-select-hero').classList.add('active');
        Game.renderCharSelect('hero');
    },
    renderCharSelect: (mode) => {
        const grid = document.getElementById(mode === 'hero' ? 'hero-select-grid' : 'party-select-grid');
        grid.innerHTML = '';
        
        let keys = Object.keys(ROLES);
        if (mode === 'hero') {
            const others = keys.filter(k => k !== 'nayuta');
            Game.shuffle(others);
            keys = ['nayuta', ...others];
        } else {
            keys = keys.filter(k => k !== State.heroId);
            Game.shuffle(keys);
        }

        keys.forEach(key => {
            const char = ROLES[key];
            const div = document.createElement('div');
            div.className = 'char-card';
            div.innerHTML = `
                <div style="font-weight:bold; color:var(--highlight-color);">${char.name}</div>
                <div style="font-size:0.85em; color:#ccc;">${char.desc}</div>
                <div style="font-size:0.8em; margin-top:3px;">
                    ç­‹:${char.stats.str} çŸ¥:${char.stats.int} æ•:${char.stats.agi}
                </div>
            `;
            div.onclick = () => mode === 'hero' ? Game.selectHero(key, div) : Game.selectAlly(key, div);
            grid.appendChild(div);
        });
    },
    selectHero: (key, el) => {
        document.querySelectorAll('#hero-select-grid .char-card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        State.heroId = key;
        document.getElementById('hero-confirm-btn').disabled = false;
    },
    confirmHero: () => {
        document.getElementById('screen-select-hero').classList.remove('active');
        document.getElementById('screen-select-party').classList.add('active');
        Game.renderCharSelect('party');
    },
    selectAlly: (key, el) => {
        if (State.selectedAllies.includes(key)) {
            State.selectedAllies = State.selectedAllies.filter(k => k !== key);
            el.classList.remove('selected');
        } else {
            if (State.selectedAllies.length < 2) {
                State.selectedAllies.push(key);
                el.classList.add('selected');
            }
        }
        const left = 2 - State.selectedAllies.length;
        document.getElementById('party-count-text').textContent = left === 0 ? "(æ±ºå®šå¯èƒ½)" : `(ã‚ã¨ ${left} å)`;
        document.getElementById('party-confirm-btn').disabled = (left !== 0);
    },
    confirmParty: () => {
        const allIds = [State.heroId, ...State.selectedAllies];
        State.party = allIds.map(key => {
            const base = ROLES[key];
            return {
                id: key,
                name: base.name,
                baseStats: { ...base.stats },
                addStats: { str:0, int:0, agi:0 },
                skill1: base.skill1,
                skill2: base.skill2,
                type: base.type,
                unlockRequirement: base.unlockRequirement,
                unlockHint: base.unlockHint,
                ending: base.ending,
                quotes: base.quotes || {atk:["ãŸãï¼"], skill:["ã„ããï¼"], guard:["å®ˆã‚‹ï¼"], win:["å‹åˆ©ï¼"]},
                hp: 0, maxHp: 0, mp: 0, maxMp: 0,
                atk: 0, matk:0, def: 0, spd: 0,
                pts: 5,
                buffs: {},
                equipment: []
            };
        });
        Game.recalcStats();
        Game.fullHeal();
        document.getElementById('screen-select-party').classList.remove('active');
        Game.toHub();
        setTimeout(Game.toggleHelp, 500);
    },
    recalcStats: () => {
        State.party.forEach(p => {
            const s = p.baseStats;
            const a = p.addStats;
            const tStr = s.str + a.str;
            const tInt = s.int + a.int;
            const tAgi = s.agi + a.agi;
            
            p.maxHp = 80 + (tStr * 15);
            p.maxMp = 40 + (tInt * 10);
            p.atk = 20 + (tStr * 3);
            p.matk = 20 + (tInt * 3);
            p.def = Math.floor(tStr * 1.5 + tInt * 0.5);
            p.spd = tAgi * 3;
            
            if(p.hp > p.maxHp) p.hp = p.maxHp;
            if(p.mp > p.maxMp) p.mp = p.maxMp;
        });
    },
    fullHeal: () => {
        State.party.forEach(p => { p.hp = p.maxHp; p.mp = p.maxMp; });
    },
    toHub: () => {
        document.getElementById('screen-battle').classList.remove('active');
        document.getElementById('screen-hub').classList.add('active');
        
        document.getElementById('floor-indicator').textContent = State.floor;
        document.getElementById('gold-display').textContent = State.gold;
        Game.renderHub();
    },
    checkSkillUnlock: (actor) => {
        if (!actor.unlockRequirement) return false;
        
        const requirement = actor.unlockRequirement;
        for (let stat in requirement) {
            const totalValue = actor.baseStats[stat] + actor.addStats[stat];
            if (totalValue < requirement[stat]) {
                return false;
            }
        }
        return true;
    },
    renderHub: () => {
        const list = document.getElementById('hub-status-list');
        list.innerHTML = '';
        const shop = document.getElementById('shop-list');
        shop.innerHTML = '';

        State.party.forEach((p, idx) => {
            const charData = ROLES[p.id];
            const isUnlocked = Game.checkSkillUnlock(p);
            
            let skill2Section = "";
            if (isUnlocked) {
                skill2Section = `
                    <div class="skill-info">
                        <div class="skill-info-title" style="color:#9b59b6;">â˜…ãƒ¬ã‚¢ã‚¹ã‚­ãƒ«ï¼š${p.skill2.name}</div>
                        <div class="skill-info-desc">${p.skill2.desc}</div>
                        <div style="color:#2ecc71; font-size:0.75em; margin-top:4px;">â˜…è§£ç¦æ¸ˆã¿ï¼</div>
                    </div>`;
            } else {
                skill2Section = `
                    <div class="skill-info" style="border-left-color:#666;">
                        <div class="skill-info-title" style="color:#888;">â˜…ãƒ¬ã‚¢ã‚¹ã‚­ãƒ«ï¼šï¼Ÿï¼Ÿï¼Ÿ</div>
                        <div class="skill-hint">${p.unlockHint || "æ¡ä»¶ã‚’æº€ãŸã™ã¨è§£ç¦ã•ã‚Œã¾ã™"}</div>
                    </div>`;
            }

            let html = `
                <div class="status-card">
                    <div style="display:flex; justify-content:space-between;">
                        <b style="color:${['#ff9999','#99ff99','#9999ff'][idx]}">${p.name}</b>
                        <span>Pt: <b class="c-yellow">${p.pts}</b></span>
                    </div>
                    <div style="font-size:0.85em; margin:5px 0;">
                        ä½“åŠ›:${p.hp}/${p.maxHp} æ°—åŠ›:${p.mp}/${p.maxMp} <br>
                        ç™ºè¨€:${p.atk} èª¬å¾—:${p.matk} é˜²å¾¡:${p.def} é€Ÿåº¦:${p.spd}
                    </div>
                    <div class="stat-btn-group">
                        <button onclick="Game.addStat(${idx},'str')" ${p.pts<=0?'disabled':''}>ç­‹ ${p.baseStats.str+p.addStats.str}</button>
                        <button onclick="Game.addStat(${idx},'int')" ${p.pts<=0?'disabled':''}>çŸ¥ ${p.baseStats.int+p.addStats.int}</button>
                        <button onclick="Game.addStat(${idx},'agi')" ${p.pts<=0?'disabled':''}>æ• ${p.baseStats.agi+p.addStats.agi}</button>
                    </div>
                    <div class="skill-info">
                        <div class="skill-info-title">ã‚¹ã‚­ãƒ«ï¼š${p.skill1.name}</div>
                        <div class="skill-info-desc">${p.skill1.desc}</div>
                    </div>
                    ${skill2Section}
                </div>`;
            list.innerHTML += html;
        });

        SHOP_ITEMS.forEach((item, idx) => {
            const div = document.createElement('div');
            div.style.cssText = "display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px dotted #555; align-items:center;";
            div.innerHTML = `
                <div style="flex:1;"><div style="font-weight:bold;">${item.name}</div><small style="color:#aaa">${item.desc}</small></div>
                <button onclick="Game.buyItem(${idx})" ${State.gold < item.cost ? 'disabled' : ''} style="padding:8px 12px; margin:0; min-height:40px; white-space:nowrap;">${item.cost}G</button>
            `;
            shop.appendChild(div);
        });
    },
    addStat: (idx, type) => {
        const p = State.party[idx];
        if (p.pts > 0) {
            p.pts--;
            p.addStats[type]++;
            Game.recalcStats();
            if(type==='str') p.hp += 15;
            if(type==='int') p.mp += 10;
            Game.renderHub();
        }
    },
    buyItem: (idx) => {
        const item = SHOP_ITEMS[idx];
        if (State.gold >= item.cost) {
            State.gold -= item.cost;
            if (item.type === 'item') {
                State.party.forEach(p => {
                   if (item.effect.includes('hp')) p.hp = Math.min(p.maxHp, p.hp + 100); 
                   if (item.effect.includes('mp')) p.mp = Math.min(p.maxMp, p.mp + 50); 
                });
                alert("å…¨å“¡å›å¾©ã—ã¾ã—ãŸï¼");
            } else {
                State.party.forEach(p => {
                    if (item.stat === 'atk') p.addStats.str += 2;
                    if (item.stat === 'matk') p.addStats.int += 2;
                    if (item.stat === 'def') { p.addStats.str += 1; p.addStats.int += 1; }
                    if (item.stat === 'spd') p.addStats.agi += 2;
                    if (item.stat === 'hp') p.addStats.str += 5; 
                    if (item.stat === 'mp') p.addStats.int += 5;
                    if (item.stat === 'all') { p.addStats.str += 1; p.addStats.int += 1; p.addStats.agi += 1; }
                });
                Game.recalcStats();
                alert(`${item.name}ã‚’è³¼å…¥ï¼å…¨å“¡ã®èƒ½åŠ›ãŒå‘ä¸Šï¼`);
            }
            Game.toHub();
        }
    },
    showEncounter: () => {
        const floor = State.floor;
        if (floor > ENEMIES.length) return;
        const enemy = ENEMIES[floor - 1];
        
        document.getElementById('encounter-msg').textContent = enemy.msg;
        document.getElementById('encounter-enemy-name').textContent = `ç™ºè¨€è€…: ${enemy.name}`;
        document.getElementById('modal-encounter').style.display = 'flex';
    }
};

/* --- 3. æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ  --- */
const Battle = {
    turnQueue: [],
    currentEnemy: null,
    activeCharIdx: -1,
    turnCount: 0,
    isProcessing: false,
    enemyStunTurns: 0,

    startCombat: () => {
        document.getElementById('modal-encounter').style.display = 'none';
        document.getElementById('screen-hub').classList.remove('active');
        document.getElementById('screen-battle').classList.add('active');
        
        Battle.turnCount = 1;
        Battle.isProcessing = false;
        Battle.enemyStunTurns = 0;
        document.getElementById('battle-log').innerHTML = '';
        
        const enemyData = ENEMIES[State.floor - 1];
        Battle.currentEnemy = { 
            ...enemyData, 
            maxHp: enemyData.hp,
            baseAtk: enemyData.atk,
            buffs: {},
            debuffs: {}
        };
        
        // ãƒ‘ãƒ¼ãƒ†ã‚£ã®ãƒãƒ•ã‚’ãƒªã‚»ãƒƒãƒˆ
        State.party.forEach(p => {
            p.buffs = {};
        });
        
        Battle.log(`---------- ä¼šè­°é–‹å§‹ ----------`);
        Battle.updateUI();
        Battle.startRound();
    },
    log: (msg, quote = null) => {
        const el = document.getElementById('battle-log');
        const div = document.createElement('div');
        div.className = 'log-entry';
        div.innerHTML = msg;
        if (quote) {
            const qSpan = document.createElement('span');
            qSpan.className = 'log-quote';
            qSpan.textContent = quote;
            div.appendChild(qSpan);
        }
        el.appendChild(div);
        el.scrollTop = el.scrollHeight;
    },
    updateUI: () => {
        const e = Battle.currentEnemy;
        const pct = Math.max(0, (e.hp / e.maxHp) * 100);
        document.getElementById('enemy-hp').style.width = `${pct}%`;
        document.getElementById('enemy-name').textContent = e.name;
        document.getElementById('enemy-hp-text').textContent = `èª¬å¾—åº¦: ${Math.max(0, e.hp)} / ${e.maxHp}`;
        document.getElementById('turn-indicator').textContent = `è­°é¡Œ ${Battle.turnCount}`;

        const pPanel = document.getElementById('battle-party-status');
        pPanel.innerHTML = '';
        State.party.forEach((p,i) => {
            const isDead = p.hp <= 0;
            const isCurrent = Battle.turnQueue.length > 0 && Battle.turnQueue[0] === p;
            const border = isCurrent ? '2px solid yellow' : '1px solid #555';
            pPanel.innerHTML += `
                <div style="min-width:80px; background:#222; padding:3px; border:${border}; opacity:${isDead?0.5:1}; border-radius:4px;">
                    <div style="font-size:0.7em; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${p.name.split('ï¼š')[1]}</div>
                    <div style="height:4px; background:#555; width:100%;"><div style="height:100%; background:#e74c3c; width:${Math.max(0,(p.hp/p.maxHp)*100)}%"></div></div>
                    <div style="height:4px; background:#555; width:100%; margin-top:1px;"><div style="height:100%; background:#3498db; width:${Math.max(0,(p.mp/p.maxMp)*100)}%"></div></div>
                </div>`;
        });
    },
    startRound: () => {
        let entities = [...State.party.filter(p=>p.hp>0), Battle.currentEnemy];
        entities.sort((a, b) => {
            const spdA = (a.spd || (a.isBoss ? 50 : 15)) + Math.random() * 10;
            const spdB = (b.spd || (b.isBoss ? 50 : 15)) + Math.random() * 10;
            return spdB - spdA;
        });
        Battle.turnQueue = entities;
        Battle.nextTurn();
    },
    nextTurn: () => {
        if (Battle.isProcessing) return;

        if (Battle.checkWinLose()) return;
        
        if (Battle.turnQueue.length === 0) {
            Battle.turnCount++;
            // DOTå‡¦ç†
            if (Battle.currentEnemy.debuffs && Battle.currentEnemy.debuffs.dot) {
                Battle.currentEnemy.debuffs.dot--;
                const dotDmg = Math.floor(Battle.currentEnemy.maxHp * 0.05);
                Battle.currentEnemy.hp -= dotDmg;
                Battle.log(`ç¶™ç¶šãƒ€ãƒ¡ãƒ¼ã‚¸ã§<span class="c-red">${dotDmg}</span>ã®ç²¾ç¥çš„åœ§åŠ›ï¼`);
            }
            Battle.startRound();
            return;
        }

        const actor = Battle.turnQueue.shift();
        Battle.updateUI();

        if (actor.hp <= 0) { 
            Battle.nextTurn(); 
            return; 
        }
        
        // ãƒãƒ•è§£é™¤å‡¦ç†
        if (actor.buffs) {
            if (actor.buffs['guard']) delete actor.buffs['guard'];
            if (actor.buffs['invincible']) delete actor.buffs['invincible'];
        }

        if (actor === Battle.currentEnemy) {
            if (Battle.enemyStunTurns > 0) {
                Battle.enemyStunTurns--;
                Battle.log(`${actor.name}ã¯æ··ä¹±ã—ã¦ã„ã‚‹ï¼`);
                setTimeout(Battle.nextTurn, 600);
                return;
            }
            Battle.isProcessing = true;
            setTimeout(() => {
                Battle.enemyAction();
                Battle.isProcessing = false;
                setTimeout(Battle.nextTurn, 600);
            }, 600);
        } else {
            document.getElementById('command-panel').style.display = 'grid';
            document.getElementById('active-char-name').textContent = actor.name;
            
            const btn1 = document.getElementById('btn-skill1');
            const btn2 = document.getElementById('btn-skill2');
            
            const costUnit = actor.id === 'akki' ? 'G' : 'æ°—åŠ›';
            const costVal = actor.id === 'akki' ? 50 : actor.skill1.cost;
            
            btn1.textContent = `${actor.skill1.name} (${costVal}${costUnit})`;
            
            if (Game.checkSkillUnlock(actor)) {
                btn2.style.display = 'block';
                btn2.textContent = `${actor.skill2.name} (â˜…)`;
                btn2.disabled = false;
            } else {
                btn2.style.display = 'none';
            }
            
            Battle.activeCharIdx = State.party.indexOf(actor);
            window.scrollTo(0, document.body.scrollHeight);
        }
    },
    executeSkillEffect: (actor, skill, enemy) => {
        let msg = "";
        const effect = skill.effect;
        const tStr = actor.baseStats.str + actor.addStats.str;
        const tInt = actor.baseStats.int + actor.addStats.int;
        
        switch(effect) {
            case "buff_atk_all":
                State.party.forEach(p => { if(p.hp>0) p.atk += 8; });
                msg = `å‘³æ–¹å…¨å“¡ã®ç™ºè¨€åŠ›ãŒã‚¢ãƒƒãƒ—ï¼`;
                break;
            case "invincible_all":
                State.party.forEach(p => { if(p.hp>0) p.buffs['invincible'] = true; });
                msg = `å‘³æ–¹å…¨å“¡ãŒå®ˆã‚Šã«å…¥ã£ãŸï¼ã“ã®ã‚¿ãƒ¼ãƒ³ãƒ€ãƒ¡ãƒ¼ã‚¸ç„¡åŠ¹ï¼`;
                break;
            case "debuff_atk_big":
                enemy.atk = Math.floor(enemy.atk * 0.5);
                msg = `ç›¸æ‰‹ã®ç™ºè¨€åŠ›ãŒå¤§å¹…ãƒ€ã‚¦ãƒ³ï¼`;
                break;
            case "percent_damage":
                const pctDmg = Math.floor(enemy.hp * 0.2);
                enemy.hp -= pctDmg;
                msg = `ç›¸æ‰‹ã®æ®‹ã‚Šèª¬å¾—åº¦ã®20%ã€<span class="c-red">${pctDmg}</span>ã‚’å‰Šã£ãŸï¼`;
                break;
            case "heal_all_small":
                const healSmall = 30 + actor.matk;
                State.party.forEach(p => { if(p.hp>0) p.hp = Math.min(p.maxHp, p.hp + healSmall); });
                msg = `å‘³æ–¹å…¨å“¡ã®HPãŒ<span class="c-green">${healSmall}</span>å›å¾©ï¼`;
                break;
            case "heal_all_full":
                State.party.forEach(p => { if(p.hp>0) p.hp = p.maxHp; });
                msg = `å‘³æ–¹å…¨å“¡ã®HPãŒå®Œå…¨å›å¾©ï¼`;
                break;
            case "taunt_invincible":
                actor.buffs['invincible'] = true;
                actor.buffs['taunt'] = true;
                msg = `ç„¡æ•µçŠ¶æ…‹ã«ãªã‚Šã€æ³¨ç›®ã‚’é›†ã‚ãŸï¼`;
                break;
            case "str_nuke":
                const strDmg = tStr * 10;
                enemy.hp -= strDmg;
                msg = `ç­‹è‚‰ã®åŠ›ã§<span class="c-red">${strDmg}</span>ã®å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                break;
            case "debuff_both":
                enemy.atk = Math.floor(enemy.atk * 0.7);
                enemy.debuffs = enemy.debuffs || {};
                enemy.debuffs.defDown = true;
                msg = `ç›¸æ‰‹ã®æ”»æ’ƒåŠ›ã¨é˜²å¾¡åŠ›ãŒãƒ€ã‚¦ãƒ³ï¼`;
                break;
            case "stun":
                Battle.enemyStunTurns = 2;
                msg = `ç›¸æ‰‹ã¯2ã‚¿ãƒ¼ãƒ³ã®é–“ã€è¡Œå‹•ä¸èƒ½ï¼`;
                break;
            case "potato":
                const hits = 3 + Math.floor(Math.random() * 3);
                let totalPotato = 0;
                for(let i = 0; i < hits; i++) {
                    const pDmg = 30 + Math.floor(Math.random() * 20);
                    totalPotato += pDmg;
                }
                enemy.hp -= totalPotato;
                msg = `${hits}å›ã®ãƒãƒ†ãƒˆæŠ•ã’ã§åˆè¨ˆ<span class="c-red">${totalPotato}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                break;
            case "smile":
                State.party.forEach(p => { 
                    if(p.hp>0) {
                        p.hp = Math.min(p.maxHp, p.hp + 80);
                        p.mp = Math.min(p.maxMp, p.mp + 40);
                        p.atk += 10;
                    }
                });
                msg = `ã‚¹ãƒã‚¤ãƒ«ã§å…¨å“¡ãŒå…ƒæ°—ã«ï¼HP80/MP40å›å¾©ã€æ”»æ’ƒ+10ï¼`;
                break;
            case "charm":
                Battle.enemyStunTurns = 1;
                msg = `ç›¸æ‰‹ã¯è¦‹ã¨ã‚Œã¦1ã‚¿ãƒ¼ãƒ³è¡Œå‹•ä¸èƒ½ï¼`;
                break;
            case "int_nuke":
                const intDmg = tInt * 8;
                enemy.hp -= intDmg;
                msg = `æ¼”æŠ€åŠ›ã§<span class="c-red">${intDmg}</span>ã®ç²¾ç¥ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                break;
            case "random":
                const rnd = Math.random();
                if (rnd < 0.4) {
                    State.party.forEach(p => { if(p.hp>0) p.hp = Math.min(p.maxHp, p.hp + 100); });
                    msg = `ã¡ã‚ƒã¶å°ãŒå›è»¢ã—ã¦â€¦å…¨å“¡HP100å›å¾©ï¼`;
                } else if (rnd < 0.8) {
                    const rndDmg = 200 + Math.floor(Math.random() * 150);
                    enemy.hp -= rndDmg;
                    msg = `ã¡ã‚ƒã¶å°ãŒé£›ã‚“ã§â€¦<span class="c-red">${rndDmg}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                } else {
                    actor.hp = Math.max(1, actor.hp - 100);
                    msg = `ã¡ã‚ƒã¶å°ãŒè·³ã­è¿”ã£ã¦â€¦è‡ªåˆ†ã«100ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                }
                break;
            case "skip_turn":
                Battle.turnQueue = Battle.turnQueue.filter(e => e !== enemy);
                msg = `ç›¸æ‰‹ã®æ¬¡ã®ç™ºè¨€æ©Ÿä¼šã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼`;
                break;
            case "barrier":
                State.party.forEach(p => { if(p.hp>0) p.hp = Math.min(p.maxHp, p.hp + 50); });
                msg = `ã‚¤ãƒ™ãƒ³ãƒˆåŠ¹æœã§å…¨å“¡ã«HP+50ã®ãƒãƒªã‚¢ï¼`;
                break;
            case "buff_all_stats":
                State.party.forEach(p => { 
                    if(p.hp>0) {
                        p.atk += 15; p.matk += 15; p.def += 10; p.spd += 10;
                    }
                });
                msg = `å¤©åœ°å‰µé€ ï¼å…¨å“¡ã®å…¨èƒ½åŠ›ãŒå¤§å¹…ã‚¢ãƒƒãƒ—ï¼`;
                break;
            case "drain":
                const drainDmg = actor.atk * 2;
                const drainHeal = Math.floor(drainDmg * 0.5);
                enemy.hp -= drainDmg;
                actor.hp = Math.min(actor.maxHp, actor.hp + drainHeal);
                msg = `<span class="c-red">${drainDmg}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼†<span class="c-green">${drainHeal}</span>å›å¾©ï¼`;
                break;
            case "feast":
                const feastDmg = actor.atk * 3;
                enemy.hp -= feastDmg;
                if (Math.random() < 0.2) {
                    enemy.hp = 0;
                    msg = `å®´ä¼šã§ç›¸æ‰‹ã‚’é£²ã¿è¾¼ã‚“ã ï¼<span class="c-red">å³æ­»ï¼</span>`;
                } else {
                    msg = `å®´ä¼šãƒ‘ãƒ¯ãƒ¼ã§<span class="c-red">${feastDmg}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                }
                break;
            case "acc_down":
                enemy.debuffs = enemy.debuffs || {};
                enemy.debuffs.accDown = 0.5;
                msg = `ç›¸æ‰‹ã®å‘½ä¸­ç‡ãŒ50%ãƒ€ã‚¦ãƒ³ï¼`;
                break;
            case "singularity":
                const singDmg = tInt * 12;
                enemy.hp -= singDmg;
                msg = `ã‚·ãƒ³ã‚®ãƒ¥ãƒ©ãƒªãƒ†ã‚£ç™ºå‹•ï¼<span class="c-red">${singDmg}</span>ã®è¶…ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                break;
            case "def_up_big":
                State.party.forEach(p => { if(p.hp>0) p.def += 20; });
                msg = `ãƒ‘ãƒ“ãƒªã‚ªãƒ³ã®å®ˆã‚Šã§å…¨å“¡ã®é˜²å¾¡+20ï¼`;
                break;
            case "future_light":
                const futureDmg = tInt * 6;
                enemy.hp -= futureDmg;
                msg = `æœªæ¥ã®è¼ãã§<span class="c-red">${futureDmg}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                break;
            case "crit_sure":
                const critDmg = actor.atk * 3;
                enemy.hp -= critDmg;
                msg = `å¿…ä¸­ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ï¼<span class="c-red">${critDmg}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                break;
            case "multi_hit":
                const multiHits = 4 + Math.floor(Math.random() * 3);
                let totalMulti = 0;
                for(let i = 0; i < multiHits; i++) {
                    totalMulti += Math.floor(actor.atk * 0.8);
                }
                enemy.hp -= totalMulti;
                msg = `${multiHits}é€£æ’ƒã§åˆè¨ˆ<span class="c-red">${totalMulti}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                break;
            case "debuff_all":
                enemy.atk = Math.floor(enemy.atk * 0.7);
                enemy.debuffs = enemy.debuffs || {};
                enemy.debuffs.defDown = true;
                enemy.debuffs.spdDown = true;
                msg = `å¨åœ§ã§ç›¸æ‰‹ã®å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒãƒ€ã‚¦ãƒ³ï¼`;
                break;
            case "legend_strike":
                const legendDmg = (tStr + tInt) * 5;
                enemy.hp -= legendDmg;
                msg = `ä¼èª¬ã®ä¸€æ’ƒï¼<span class="c-red">${legendDmg}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                break;
            case "dot":
                enemy.debuffs = enemy.debuffs || {};
                enemy.debuffs.dot = 3;
                const dotInitial = Math.floor(enemy.maxHp * 0.05);
                enemy.hp -= dotInitial;
                msg = `æ¿€è¾›ã‚½ãƒ¼ã‚¹ã§3ã‚¿ãƒ¼ãƒ³ç¶™ç¶šãƒ€ãƒ¡ãƒ¼ã‚¸ï¼†<span class="c-red">${dotInitial}</span>ï¼`;
                break;
            case "explosion":
                const expDmg = (tStr + tInt) * 4;
                enemy.hp -= expDmg;
                enemy.debuffs = enemy.debuffs || {};
                enemy.debuffs.dot = 2;
                msg = `å¤§çˆ†ç™ºï¼<span class="c-red">${expDmg}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼†ç‚ä¸Šï¼`;
                break;
            case "heal_cure":
                const curHeal = 60 + actor.matk;
                State.party.forEach(p => { 
                    if(p.hp>0) {
                        p.hp = Math.min(p.maxHp, p.hp + curHeal);
                        delete p.buffs['poison'];
                    }
                });
                msg = `å…¨å“¡HP<span class="c-green">${curHeal}</span>å›å¾©ï¼†çŠ¶æ…‹ç•°å¸¸æ²»ç™’ï¼`;
                break;
            case "speed_boost":
                State.party.forEach(p => { if(p.hp>0) p.spd *= 2; p.buffs['speedBoost'] = 3; });
                msg = `æŒ‡ç¬›ã§å…¨å“¡ã®é€Ÿåº¦ãŒ2å€ã«ï¼`;
                break;
            case "bamboo":
                const bambooDmg = actor.atk * 2.5;
                const bambooHeal = Math.floor(bambooDmg * 0.3);
                enemy.hp -= bambooDmg;
                actor.hp = Math.min(actor.maxHp, actor.hp + bambooHeal);
                msg = `ç¬¹ã‚¢ã‚¿ãƒƒã‚¯ã§<span class="c-red">${Math.floor(bambooDmg)}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼†<span class="c-green">${bambooHeal}</span>å›å¾©ï¼`;
                break;
            case "fluffy":
                State.party.forEach(p => { 
                    if(p.hp>0) {
                        p.hp = Math.min(p.maxHp, p.hp + 150);
                        p.def += 15;
                    }
                });
                msg = `ãƒ¢ãƒ•ãƒ¢ãƒ•ã§å…¨å“¡HP150å›å¾©ï¼†é˜²å¾¡+15ï¼`;
                break;
            case "life_drain":
                const lifeDmg = actor.matk * 2;
                enemy.hp -= lifeDmg;
                actor.hp = Math.min(actor.maxHp, actor.hp + lifeDmg);
                msg = `<span class="c-red">${lifeDmg}</span>å¸åï¼`;
                break;
            case "infect":
                enemy.debuffs = enemy.debuffs || {};
                enemy.debuffs.dot = 3;
                enemy.atk = Math.floor(enemy.atk * 0.6);
                msg = `é™¢å†…æ„ŸæŸ“ï¼3ã‚¿ãƒ¼ãƒ³ç¶™ç¶šãƒ€ãƒ¡ãƒ¼ã‚¸ï¼†æ”»æ’ƒ40%ãƒ€ã‚¦ãƒ³ï¼`;
                break;
            case "self_buff_big":
                actor.atk += 25;
                actor.matk += 25;
                msg = `ç´³å£«ã®å—œã¿ã§æ”»æ’ƒã¨é­”åŠ›ãŒ+25ï¼`;
                break;
            case "ultimate":
                const ultDmg = (tStr + tInt) * 8;
                enemy.hp -= ultDmg;
                actor.hp = Math.max(1, Math.floor(actor.hp * 0.5));
                msg = `æ¥µé™ã®ä¸€æ’ƒï¼<span class="c-red">${ultDmg}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ï¼ˆè‡ªåˆ†HPåŠæ¸›ï¼‰`;
                break;
            case "noodle":
                const noodleDmg = actor.atk * 2;
                enemy.hp -= noodleDmg;
                enemy.debuffs = enemy.debuffs || {};
                enemy.debuffs.spdDown = true;
                msg = `éººã§çµ¡ã‚ã¦<span class="c-red">${noodleDmg}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼†é€Ÿåº¦ãƒ€ã‚¦ãƒ³ï¼`;
                break;
            case "calorie_bomb":
                const calDmg = tStr * 15;
                enemy.hp -= calDmg;
                msg = `ã‚«ãƒ­ãƒªãƒ¼çˆ†å¼¾ç‚¸è£‚ï¼<span class="c-red">${calDmg}</span>ã®è¶…ç‰¹å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                break;
            case "bad_luck":
                enemy.debuffs = enemy.debuffs || {};
                enemy.debuffs.accDown = 0.3;
                enemy.debuffs.evaDown = true;
                msg = `ä¸é‹ä¼æŸ“ï¼ç›¸æ‰‹ã®å‘½ä¸­ã¨å›é¿ãŒæ¿€æ¸›ï¼`;
                break;
            case "purify":
                const purifyDmg = Math.floor(enemy.hp * 0.1);
                enemy.hp -= purifyDmg;
                enemy.buffs = {};
                msg = `å„è½ã¨ã—ã§<span class="c-red">${purifyDmg}</span>å‰Šã‚Šï¼†ç›¸æ‰‹ãƒãƒ•è§£é™¤ï¼`;
                break;
            case "stone_wall":
                State.party.forEach(p => { if(p.hp>0) p.def += 15; });
                actor.buffs['taunt'] = true;
                msg = `çŸ³åƒå¬å–šï¼å…¨å“¡é˜²å¾¡+15ï¼†æŒ‘ç™ºï¼`;
                break;
            case "easter":
                const easterDmg = (tStr + tInt) * 4;
                enemy.hp -= easterDmg;
                msg = `ã‚¤ãƒ¼ã‚¹ã‚¿ãƒ¼ã®æ€’ã‚Šï¼<span class="c-red">${easterDmg}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
                break;
            case "reflect":
                actor.buffs['reflect'] = 0.5;
                msg = `è²¬ä»»è»¢å«ï¼å—ã‘ã‚‹ãƒ€ãƒ¡ã®50%ã‚’åå°„ï¼`;
                break;
            case "confusion":
                Battle.enemyStunTurns = 1;
                msg = `ç›¸æ‰‹ã¯è‡ªåˆ†ã‚’æ”»æ’ƒã—ã‚ˆã†ã¨ã—ã¦æ··ä¹±ï¼`;
                break;
            case "dispel":
                enemy.buffs = {};
                msg = `ç›¸æ‰‹ã®æœ‰åˆ©ãªçŠ¶æ…‹ã‚’å…¨ã¦è§£é™¤ï¼`;
                break;
            case "revive":
                const dead = State.party.find(p => p.hp <= 0);
                if (dead) {
                    dead.hp = Math.floor(dead.maxHp * 0.5);
                    msg = `${dead.name.split('ï¼š')[1]}ã‚’è˜‡ç”Ÿï¼HP50%ã§å¾©æ´»ï¼`;
                } else {
                    msg = `è˜‡ç”Ÿå¯¾è±¡ãŒã„ãªã„â€¦æ°—åŠ›ãŒç„¡é§„ã«ï¼`;
                }
                break;
            case "armor_break":
                enemy.debuffs = enemy.debuffs || {};
                enemy.debuffs.armorBreak = 3;
                msg = `é‰±çŸ³é‘‘å®šã§ç›¸æ‰‹ã®é˜²å¾¡ã‚’3ã‚¿ãƒ¼ãƒ³0ã«ï¼`;
                break;
            case "gobo":
                const goboDmg = (tStr + tInt) * 6;
                enemy.hp -= goboDmg;
                Battle.enemyStunTurns = 1;
                msg = `ã‚´ãƒœã‚¦ã•ã‚“å¬å–šï¼éå»ã®è»‹è½¢ãŒåŠ›ã«ï¼<span class="c-red">${goboDmg}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼†ã‚¹ã‚¿ãƒ³ï¼`;
                break;
            default:
                const defDmg = actor.atk + actor.matk;
                enemy.hp -= defDmg;
                msg = `<span class="c-red">${defDmg}</span>ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
        }
        return msg;
    },
    action: (type) => {
        if (Battle.isProcessing) return;
        
        const actor = State.party[Battle.activeCharIdx];
        const enemy = Battle.currentEnemy;
        document.getElementById('command-panel').style.display = 'none';
        Battle.isProcessing = true;

        let msg = "";
        let quote = "";
        const getRandomQuote = (cat) => {
            const quotes = actor.quotes[cat];
            return quotes ? quotes[Math.floor(Math.random() * quotes.length)] : "";
        };

        if (type === 'attack') {
            let dmg = Math.floor(actor.atk * (0.8 + Math.random()*0.4));
            if (enemy.debuffs && enemy.debuffs.armorBreak) dmg = Math.floor(dmg * 1.5);
            enemy.hp -= dmg;
            msg = `<b>${actor.name}</b>ãŒç™ºè¨€ï¼ <span class="c-red">${dmg}ãƒã‚¤ãƒ³ãƒˆèª¬å¾—ï¼</span>`;
            if(dmg > actor.atk * 1.1) msg += " <span class='c-yellow'>(é‹­ã„æŒ‡æ‘˜!)</span>";
            quote = getRandomQuote('atk');

        } else if (type === 'guard') {
            actor.buffs['guard'] = true;
            const rec = Math.floor(actor.maxMp * 0.15) + 8;
            actor.mp = Math.min(actor.maxMp, actor.mp + rec);
            msg = `<b>${actor.name}</b>ã¯å‚¾è´ã—ã¦ãƒ¡ãƒ¢ã‚’å–ã£ãŸï¼ æ°—åŠ›ãŒ<span class="c-blue">${rec}</span>å›å¾©ï¼`;
            quote = getRandomQuote('guard');

        } else if (type === 'skill1' || type === 'skill2') {
            const skill = (type === 'skill1') ? actor.skill1 : actor.skill2;
            let canUse = true;

            if (actor.id === 'akki' && type === 'skill1') {
                if (State.gold < 50) {
                    alert("ãŠé‡‘ãŒè¶³ã‚Šãªã„ï¼"); 
                    canUse = false;
                } else {
                    State.gold -= 50;
                }
            } else if (actor.id !== 'akki' || type === 'skill2') {
                if (actor.mp < skill.cost) {
                    alert("æ°—åŠ›ãŒè¶³ã‚Šãªã„ï¼"); 
                    canUse = false;
                } else {
                    actor.mp -= skill.cost;
                }
            }

            if (!canUse) {
                document.getElementById('command-panel').style.display = 'grid';
                Battle.isProcessing = false;
                return;
            }
            
            quote = getRandomQuote('skill');
            const effectMsg = Battle.executeSkillEffect(actor, skill, enemy);
            msg = `<b>${actor.name}</b>ã®${skill.name}ï¼ ${effectMsg}`;
        }

        Battle.log(msg, quote);
        Battle.updateUI();
        document.getElementById('gold-display').textContent = State.gold;
        
        setTimeout(() => {
            Battle.isProcessing = false;
            Battle.nextTurn();
        }, 800);
    },
    enemyAction: () => {
        const e = Battle.currentEnemy;
        let targets = State.party.filter(p => p.hp > 0);
        if (targets.length === 0) return;
        
        // æŒ‘ç™ºå¯¾è±¡å„ªå…ˆ
        const taunter = targets.find(p => p.buffs && p.buffs.taunt);
        const target = taunter || targets[Math.floor(Math.random() * targets.length)];

        let actionType = "attack";
        if (e.type === 'charge' && Math.random() < 0.3) actionType = "charge";
        else if (e.hp < e.maxHp * 0.3 && Math.random() < 0.4) actionType = "heal";
        else if (Math.random() < 0.2) actionType = "special";

        let dmg = Math.max(1, e.atk - Math.floor(target.def/2));
        let msg = "";

        // å‘½ä¸­ç‡ãƒã‚§ãƒƒã‚¯
        if (e.debuffs && e.debuffs.accDown && Math.random() > e.debuffs.accDown) {
            Battle.log(`${e.name}ã®ç™ºè¨€ã¯çš„å¤–ã‚Œã ã£ãŸï¼`);
            return;
        }

        if (actionType === "charge") {
            if (!e.buffs) e.buffs = {};
            e.buffs['charged'] = true;
            msg = `${e.name}ã¯æ€’ã‚Šã‚’æºœã‚ã¦ã„ã‚‹â€¦ï¼`;
        } 
        else if (actionType === "heal") {
            const heal = Math.floor(e.maxHp * 0.2);
            e.hp = Math.min(e.maxHp, e.hp + heal);
            msg = `${e.name}ã¯è‡ªå·±å¼è­·ã‚’å§‹ã‚ãŸï¼ èª¬å¾—åº¦ãŒ${heal}å›å¾©ï¼`;
        }
        else if (actionType === "special") {
            dmg = Math.floor(dmg * 1.5);
            if (target.buffs['invincible']) dmg = 0;
            if (target.buffs['reflect']) {
                const refDmg = Math.floor(dmg * target.buffs['reflect']);
                e.hp -= refDmg;
                msg = `${e.name}ã®ç†±å¼ï¼ã—ã‹ã—${target.name}ãŒ${refDmg}åå°„ï¼`;
            } else {
                target.hp -= dmg;
                msg = `${e.name}ã®ç†±å¼ï¼${target.name}ã¯<span class="c-red">${dmg}æ¶ˆè€—</span>ï¼`;
            }
        }
        else {
            if (e.buffs && e.buffs.charged) {
                dmg = Math.floor(dmg * 2.5);
                msg = `æºœã‚ãŸæ€’ã‚ŠãŒç‚¸è£‚ï¼ `;
                delete e.buffs.charged;
            } else {
                msg = `${e.name}ã®åè«–ï¼ `;
            }

            if (target.buffs['invincible']) {
                dmg = 0;
                msg += `${target.name}ã«ã¯éŸ¿ã‹ãªã„ï¼`;
            } else if (target.buffs['guard']) {
                dmg = Math.floor(dmg * 0.4);
                msg += `${target.name}ã¯å†·é™ã«å—ã‘æ­¢ã‚<span class="c-red">${dmg}æ¶ˆè€—</span>ã«æŠ‘ãˆãŸï¼`;
                target.hp -= dmg;
            } else if (target.buffs['reflect']) {
                const refDmg = Math.floor(dmg * target.buffs['reflect']);
                target.hp -= dmg;
                e.hp -= refDmg;
                msg += `${target.name}ã«<span class="c-red">${dmg}æ¶ˆè€—</span>ï¼ï¼ˆ${refDmg}åå°„ï¼‰`;
            } else {
                msg += `${target.name}ã¯<span class="c-red">${dmg}æ¶ˆè€—</span>ï¼`;
                target.hp -= dmg;
            }
        }

        Battle.log(msg);
        Battle.updateUI();
    },
    checkWinLose: () => {
        const allEnemyDefeated = Battle.currentEnemy.hp <= 0;
        const allPlayerDefeated = State.party.every(p => p.hp <= 0);

        if (allEnemyDefeated) {
            if (State.floor >= ENEMIES.length) {
                Battle.log(`---------- ${Battle.currentEnemy.name} ã‚’èª¬å¾—ã—ãŸï¼ ----------`);
                setTimeout(() => {
                    Game.showEnding();
                }, 800);
                return true;
            } else {
                Battle.log(`ğŸ‰ <span class="c-green"><b>${Battle.currentEnemy.name}ã‚’èª¬å¾—ã—ãŸï¼</b></span>`);
                setTimeout(() => {
                    const reward = Battle.currentEnemy.gold;
                    State.gold += reward;
                    State.party.forEach(p => { if(p.hp>0) p.pts += 4; });
                    State.floor++;
                    alert(`åˆæ„å½¢æˆï¼\næ´»å‹•è³‡é‡‘ ${reward}G ã‚’ç²å¾—ï¼`);
                    Game.toHub();
                }, 800);
                return true;
            }
        }

        if (allPlayerDefeated) {
            Battle.log(`ğŸ’€ <span class="c-red"><b>å…¨å“¡ç–²å¼Šã—ã¾ã—ãŸ...</b></span>`);
            setTimeout(() => {
                alert("å…¨å“¡ç–²å¼Šã—ã¾ã—ãŸ...\nä¼‘æ†©ã—ã¦ã‚„ã‚Šç›´ã—ã¾ã™ã€‚");
                Game.fullHeal();
                Game.toHub();
            }, 800);
            return true;
        }

        return false;
    }
};

/* --- ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚° --- */
Game.showEnding = () => {
    document.getElementById('screen-battle').classList.remove('active');
    document.getElementById('modal-ending').style.display = 'flex';

    const text = document.getElementById('ending-text');
    
    // ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¡ãƒ³ãƒãƒ¼ã®ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆ
    const partyEndings = State.party.map(p => {
        const shortName = p.name.split('ï¼š')[1];
        return `ã€${shortName}ã€‘\n${p.ending || "ç„é–¢ã§å¹³å’Œã«æš®ã‚‰ã—ã¦ã„ã‚‹ã€‚"}`;
    }).join('\n\n');

    let endingText = `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€€ã€€ã€€ã€€ã€€ğŸ  å¤§ å›£ å†† ğŸ 
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

é•·ã„é•·ã„ä¼šè­°ã®æœ«ã€PTAä¼šé•·ï¼šã¯ã¬ã¬ã¯
å„ªé›…ã«ãƒ†ã‚£ãƒ¼ã‚«ãƒƒãƒ—ã‚’ç½®ã„ãŸã€‚

ã¯ã¬ã¬ã€Œã‚ã‚‰ï½ã€ã‚ˆãé ‘å¼µã£ãŸã‚ã­ï½â™¡
ã€€ã€€ã€€ã“ã‚“ãªã«ç†±å¿ƒãªå­ãŸã¡ã€ä¹…ã—ã¶ã‚Šã«è¦‹ãŸã‚ï½ã€

å½¼å¥³ã¯çª“ã®å¤–ã‚’çœºã‚ãªãŒã‚‰ã€ãµãµã£ã¨å¾®ç¬‘ã‚“ã ã€‚

ã¯ã¬ã¬ã€Œã­ãˆã€ã‚ãªãŸãŸã¡ã€‚
ã€€ã€€ã€€ã”è¤’ç¾ã«ã€ã†ã¡ã®ç„é–¢ã§é£¼ã£ã¦ã‚ã’ã‚‹ã‚ï½â™¡ã€

â€¦ãˆï¼Ÿ

ã¯ã¬ã¬ã€Œæ¯æ—¥ãŠæ°´ã¨ã”é£¯ã¯ã‚ã’ã‚‹ã‹ã‚‰ã€
ã€€ã€€ã€€å®‰å¿ƒã—ãªã•ã„ãªï½ã€‚
ã€€ã€€ã€€ã‚ã€é¦–è¼ªã¯å¥½ããªè‰²ã‚’é¸ã‚“ã§ã„ã„ã‚ã‚ˆï½ã€

ã“ã†ã—ã¦å‹‡è€…ãŸã¡ã¯ã€
ã¯ã¬ã¬é‚¸ã®ç„é–¢ã§é£¼ã‚ã‚Œã‚‹ã“ã¨ã«ãªã£ãŸã€‚

ãªã‚“ã ã‹ã‚ˆãåˆ†ã‹ã‚‰ãªã„ãŒã€
æ‚ªããªã„çµæœ«ãªã®ã‹ã‚‚ã—ã‚Œãªã„ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€€ã€€ã€€ã€€ï½ ãã®å¾Œã®å‹‡è€…ãŸã¡ ï½
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

${partyEndings}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€€ã€€ã€€ã€€ã€€ï½ ã‚¨ãƒ”ãƒ­ãƒ¼ã‚° ï½
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ãã‚Œã‹ã‚‰æ•°å¹´å¾Œâ€”â€”

ã¯ã¬ã¬é‚¸ã®ç„é–¢ã¯ã€åœ°åŸŸã§ä¸€ç•ªè³‘ã‚„ã‹ãªå ´æ‰€ã«ãªã£ãŸã€‚

å…ƒå‹‡è€…ãŸã¡ã¯æ¯æ—¥æ¥½ã—ãã†ã«æš®ã‚‰ã—ã€
è¿‘æ‰€ã®å­ã©ã‚‚ãŸã¡ãŒéŠã³ã«æ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã€
ã„ã¤ã—ã‹ã€Œä¼èª¬ã®ç„é–¢ã€ã¨å‘¼ã°ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

ã¯ã¬ã¬ã¯ç›¸å¤‰ã‚ã‚‰ãšã€Œã‚ã‚‰ï½ã€ã¨è¨€ã„ãªãŒã‚‰ã€
ã¿ã‚“ãªã«ãŠè“å­ã‚’é…ã£ã¦ã„ã‚‹ã€‚

é­”ç‹ãªã‚“ã¦ã€æœ€åˆã‹ã‚‰ã„ãªã‹ã£ãŸã®ã‹ã‚‚ã—ã‚Œãªã„ã€‚
ã„ãŸã®ã¯ã€ã¡ã‚‡ã£ã¨ã‚«ãƒªã‚¹ãƒæ€§ãŒé«˜ã™ãã‚‹
PTAä¼šé•·ã¨ã€ç†±å¿ƒã™ãã‚‹å‹‡è€…ãŸã¡ã ã‘ã ã£ãŸã€‚

æœ¬å½“ã«å¤§åˆ‡ãªã®ã¯ã€å‹ã¡è² ã‘ã˜ã‚ƒãªã„ã€‚
ã¿ã‚“ãªã§ä¸€ç·’ã«ã„ã‚‰ã‚Œã‚‹å ´æ‰€ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã€‚

ãŸã¨ãˆãã‚ŒãŒã€èª°ã‹ã®å®¶ã®ç„é–¢ã ã£ãŸã¨ã—ã¦ã‚‚ã€‚

ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ï½ å®Œ ï½

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‰ SPECIAL THANKS ğŸ‰

${State.party.map(p => 'â­ ' + p.name).join('\n')}

ãã—ã¦ã€æœ€å¾Œã¾ã§éŠã‚“ã§ãã‚ŒãŸã‚ãªãŸã¸ã€‚

ã¯ã¬ã¬ã€Œã¾ãŸéŠã³ã«æ¥ã¦ã­ï½â™¡ã€

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
`;
    text.textContent = endingText.trim();
};

// åˆæœŸåŒ–
window.onload = () => {
    document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
    document.getElementById('screen-title').classList.add('active');
};
</script>
</body>
</html>